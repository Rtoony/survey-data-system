-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.abbreviation_standards (
  abbreviation_id integer NOT NULL DEFAULT nextval('abbreviation_standards_abbreviation_id_seq'::regclass),
  abbreviation character varying NOT NULL UNIQUE,
  full_text character varying NOT NULL,
  discipline character varying,
  category character varying,
  usage_context text,
  description text,
  tags ARRAY,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  context_usage_notes text,
  is_ada_critical boolean DEFAULT false,
  conflict_risk character varying CHECK (conflict_risk::text = ANY (ARRAY['Low'::character varying, 'Medium'::character varying, 'High'::character varying]::text[])),
  CONSTRAINT abbreviation_standards_pkey PRIMARY KEY (abbreviation_id)
);
CREATE TABLE public.abbreviation_standards_backup (
  abbreviation_id integer,
  abbreviation character varying,
  full_text character varying,
  discipline character varying,
  category character varying,
  usage_context text,
  description text,
  tags ARRAY,
  created_at timestamp without time zone,
  updated_at timestamp without time zone
);
CREATE TABLE public.accuracy_standards (
  standard_id integer NOT NULL DEFAULT nextval('accuracy_standards_standard_id_seq'::regclass),
  point_type character varying NOT NULL,
  accuracy_class character varying NOT NULL,
  horizontal_tolerance_ft numeric NOT NULL,
  vertical_tolerance_ft numeric NOT NULL,
  horizontal_95ci_ft numeric NOT NULL,
  vertical_95ci_ft numeric NOT NULL,
  description text,
  standard_reference character varying,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT accuracy_standards_pkey PRIMARY KEY (standard_id)
);
CREATE TABLE public.alignment_pis (
  pi_id uuid NOT NULL DEFAULT gen_random_uuid(),
  alignment_id uuid,
  pi_number integer NOT NULL,
  station numeric NOT NULL,
  geometry USER-DEFINED,
  curve_type character varying,
  curve_radius numeric,
  curve_length numeric,
  delta_angle numeric,
  tangent_length numeric,
  spiral_in_length numeric,
  spiral_out_length numeric,
  superelevation numeric,
  notes text,
  continuity_before character varying,
  continuity_after character varying,
  continuity_warning text,
  CONSTRAINT alignment_pis_pkey PRIMARY KEY (pi_id),
  CONSTRAINT alignment_pis_alignment_id_fkey FOREIGN KEY (alignment_id) REFERENCES public.horizontal_alignments(alignment_id)
);
CREATE TABLE public.alignments (
  alignment_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  name text,
  design_speed numeric,
  classification text,
  srid integer,
  geom USER-DEFINED,
  station_start numeric,
  CONSTRAINT alignments_pkey PRIMARY KEY (alignment_id),
  CONSTRAINT alignments_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.annotation_standards (
  annotation_id integer NOT NULL DEFAULT nextval('annotation_standards_annotation_id_seq'::regclass),
  annotation_name character varying NOT NULL,
  annotation_type character varying,
  text_style_id uuid,
  leader_style character varying,
  arrow_type character varying,
  arrow_size numeric,
  text_height numeric,
  text_color character varying,
  background_mask boolean DEFAULT false,
  frame_type character varying,
  discipline character varying,
  usage_context text,
  description text,
  example_text character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT annotation_standards_pkey PRIMARY KEY (annotation_id),
  CONSTRAINT annotation_standards_text_style_id_fkey FOREIGN KEY (text_style_id) REFERENCES public.text_styles(style_id)
);
CREATE TABLE public.block_attribute_values (
  value_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  insert_id uuid,
  attribute_id uuid,
  attribute_value text,
  CONSTRAINT block_attribute_values_pkey PRIMARY KEY (value_id),
  CONSTRAINT block_attribute_values_insert_id_fkey FOREIGN KEY (insert_id) REFERENCES public.block_inserts(insert_id),
  CONSTRAINT block_attribute_values_attribute_id_fkey FOREIGN KEY (attribute_id) REFERENCES public.block_attributes(attribute_id)
);
CREATE TABLE public.block_attributes (
  attribute_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  block_id uuid,
  attribute_tag character varying NOT NULL,
  attribute_prompt text,
  default_value text,
  is_constant boolean DEFAULT false,
  position_x double precision,
  position_y double precision,
  semantic_meaning text,
  CONSTRAINT block_attributes_pkey PRIMARY KEY (attribute_id),
  CONSTRAINT block_attributes_block_id_fkey FOREIGN KEY (block_id) REFERENCES public.block_definitions(block_id)
);
CREATE TABLE public.block_definitions (
  block_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  block_name character varying NOT NULL UNIQUE,
  block_type character varying,
  category character varying,
  domain character varying,
  description text,
  space_type character varying CHECK (space_type::text = ANY (ARRAY['MODEL_SPACE'::character varying, 'PAPER_SPACE'::character varying, 'BOTH'::character varying]::text[])),
  svg_content text NOT NULL,
  svg_viewbox character varying,
  base_point_x double precision DEFAULT 0,
  base_point_y double precision DEFAULT 0,
  base_point_z double precision DEFAULT 0,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  block_embedding USER-DEFINED,
  semantic_type character varying,
  semantic_label character varying,
  usage_context text,
  tags ARRAY,
  metadata jsonb,
  is_title_block boolean DEFAULT false,
  is_detail boolean DEFAULT false,
  title_block_size character varying,
  detail_category character varying,
  tsv tsvector DEFAULT to_tsvector('english'::regconfig, (((COALESCE(block_name, ''::character varying))::text || ' '::text) || COALESCE(description, ''::text))),
  CONSTRAINT block_definitions_pkey PRIMARY KEY (block_id)
);
CREATE TABLE public.block_inserts (
  insert_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid,
  block_id uuid,
  insert_x double precision NOT NULL,
  insert_y double precision NOT NULL,
  insert_z double precision DEFAULT 0,
  scale_x double precision DEFAULT 1.0,
  scale_y double precision DEFAULT 1.0,
  rotation double precision DEFAULT 0,
  layout_name character varying DEFAULT 'Model'::character varying,
  space_type character varying,
  transformed_geometry USER-DEFINED,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  metadata jsonb,
  CONSTRAINT block_inserts_pkey PRIMARY KEY (insert_id),
  CONSTRAINT block_inserts_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT block_inserts_block_id_fkey FOREIGN KEY (block_id) REFERENCES public.block_definitions(block_id)
);
CREATE TABLE public.bmps (
  bmp_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  type text,
  area_acres numeric,
  drainage_area_acres numeric,
  install_date date,
  status text DEFAULT 'active'::text CHECK (status = ANY (ARRAY['active'::text, 'retired'::text])),
  compliance text DEFAULT 'good'::text CHECK (compliance = ANY (ARRAY['good'::text, 'needs_attention'::text, 'non_compliant'::text])),
  geom USER-DEFINED,
  metadata jsonb,
  CONSTRAINT bmps_pkey PRIMARY KEY (bmp_id),
  CONSTRAINT bmps_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.breakline_type_rules (
  type_id integer NOT NULL DEFAULT nextval('breakline_type_rules_type_id_seq'::regclass),
  breakline_type character varying NOT NULL UNIQUE,
  description text,
  requires_z_monotonic boolean DEFAULT false,
  allowed_z_direction character varying,
  max_z_reverse_tolerance numeric DEFAULT 0.01,
  min_vertex_count integer DEFAULT 2,
  max_vertex_spacing_ft numeric,
  requires_closure boolean DEFAULT false,
  default_proximity_type character varying DEFAULT 'STANDARD'::character varying,
  default_is_one_sided boolean DEFAULT false,
  z_violation_severity character varying DEFAULT 'ERROR'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT breakline_type_rules_pkey PRIMARY KEY (type_id)
);
CREATE TABLE public.canonical_features (
  feature_id uuid NOT NULL DEFAULT gen_random_uuid(),
  drawing_id uuid NOT NULL,
  project_id uuid NOT NULL,
  feature_type text NOT NULL,
  layer_name text,
  native_geom USER-DEFINED,
  native_srid integer,
  geom USER-DEFINED,
  metadata jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT canonical_features_pkey PRIMARY KEY (feature_id),
  CONSTRAINT canonical_features_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT canonical_features_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.code_references (
  code_id integer NOT NULL DEFAULT nextval('code_references_code_id_seq'::regclass),
  code_name character varying NOT NULL,
  code_abbreviation character varying,
  code_type character varying,
  issuing_authority character varying,
  edition character varying,
  publication_year integer,
  jurisdiction character varying,
  scope text,
  web_url text,
  is_current boolean DEFAULT true,
  notes text,
  tags ARRAY,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT code_references_pkey PRIMARY KEY (code_id)
);
CREATE TABLE public.color_standards (
  color_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  color_index integer NOT NULL UNIQUE CHECK (color_index >= 1 AND color_index <= 255),
  color_name character varying NOT NULL,
  color_rgb character varying NOT NULL,
  hex_code character varying,
  usage_category character varying,
  description text,
  CONSTRAINT color_standards_pkey PRIMARY KEY (color_id)
);
CREATE TABLE public.confidence_thresholds (
  threshold_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  threshold_name character varying NOT NULL DEFAULT 'default'::character varying,
  auto_accept_threshold integer DEFAULT 80 CHECK (auto_accept_threshold >= 0 AND auto_accept_threshold <= 100),
  auto_reject_threshold integer DEFAULT 60 CHECK (auto_reject_threshold >= 0 AND auto_reject_threshold <= 100),
  extraction_weight integer DEFAULT 40 CHECK (extraction_weight >= 0 AND extraction_weight <= 100),
  relationship_weight integer DEFAULT 30 CHECK (relationship_weight >= 0 AND relationship_weight <= 100),
  mapping_weight integer DEFAULT 15 CHECK (mapping_weight >= 0 AND mapping_weight <= 100),
  validation_weight integer DEFAULT 15 CHECK (validation_weight >= 0 AND validation_weight <= 100),
  min_extraction_score integer DEFAULT 50 CHECK (min_extraction_score >= 0 AND min_extraction_score <= 100),
  min_relationship_score integer DEFAULT 40 CHECK (min_relationship_score >= 0 AND min_relationship_score <= 100),
  min_mapping_score integer DEFAULT 50 CHECK (min_mapping_score >= 0 AND min_mapping_score <= 100),
  min_validation_score integer DEFAULT 60 CHECK (min_validation_score >= 0 AND min_validation_score <= 100),
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  deleted_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  notes text,
  CONSTRAINT confidence_thresholds_pkey PRIMARY KEY (threshold_id),
  CONSTRAINT confidence_thresholds_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.conflicts (
  conflict_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  utility_id uuid,
  location USER-DEFINED,
  description text,
  severity text DEFAULT 'medium'::text CHECK (severity = ANY (ARRAY['low'::text, 'medium'::text, 'high'::text])),
  resolved boolean DEFAULT false,
  suggestions ARRAY,
  CONSTRAINT conflicts_pkey PRIMARY KEY (conflict_id),
  CONSTRAINT conflicts_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT conflicts_utility_id_fkey FOREIGN KEY (utility_id) REFERENCES public.utilities(utility_id)
);
CREATE TABLE public.control_point_membership (
  membership_id uuid NOT NULL DEFAULT gen_random_uuid(),
  network_id uuid,
  point_id uuid,
  is_fixed_point boolean DEFAULT false,
  adjusted_northing numeric,
  adjusted_easting numeric,
  adjusted_elevation numeric,
  residual_h numeric,
  residual_v numeric,
  standard_error_h numeric,
  standard_error_v numeric,
  adjustment_notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT control_point_membership_pkey PRIMARY KEY (membership_id),
  CONSTRAINT control_point_membership_network_id_fkey FOREIGN KEY (network_id) REFERENCES public.survey_control_network(network_id),
  CONSTRAINT control_point_membership_point_id_fkey FOREIGN KEY (point_id) REFERENCES public.survey_points(point_id)
);
CREATE TABLE public.coordinate_systems (
  system_id integer NOT NULL DEFAULT nextval('coordinate_systems_system_id_seq'::regclass),
  epsg_code character varying NOT NULL UNIQUE,
  system_name character varying NOT NULL,
  region character varying,
  datum character varying,
  units character varying,
  zone_number integer,
  notes text,
  is_active boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT coordinate_systems_pkey PRIMARY KEY (system_id)
);
CREATE TABLE public.cross_section_points (
  xsection_point_id uuid NOT NULL DEFAULT gen_random_uuid(),
  section_id uuid,
  point_number integer NOT NULL,
  cross_offset numeric,
  elevation numeric,
  point_type character varying,
  slope_ratio character varying,
  cut_fill_flag character,
  cut_fill_depth numeric,
  notes text,
  CONSTRAINT cross_section_points_pkey PRIMARY KEY (xsection_point_id),
  CONSTRAINT cross_section_points_section_id_fkey FOREIGN KEY (section_id) REFERENCES public.cross_sections(section_id)
);
CREATE TABLE public.cross_sections (
  section_id uuid NOT NULL DEFAULT gen_random_uuid(),
  alignment_id uuid,
  station numeric NOT NULL,
  section_type character varying,
  section_geometry USER-DEFINED NOT NULL,
  cut_area numeric,
  fill_area numeric,
  description text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT cross_sections_pkey PRIMARY KEY (section_id),
  CONSTRAINT cross_sections_alignment_id_fkey FOREIGN KEY (alignment_id) REFERENCES public.horizontal_alignments(alignment_id)
);
CREATE TABLE public.detail_standards (
  detail_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  block_id uuid,
  detail_number character varying,
  detail_title character varying NOT NULL,
  detail_category character varying,
  applicable_layers ARRAY,
  applicable_symbols ARRAY,
  scale character varying,
  description text,
  usage_context text,
  typical_application text,
  code_references ARRAY,
  metadata jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  discipline character varying,
  category character varying,
  csi_section character varying,
  related_blocks ARRAY,
  related_layers ARRAY,
  ada_standard character varying,
  cbc_standard character varying,
  tsv tsvector DEFAULT to_tsvector('english'::regconfig, (((COALESCE(detail_title, ''::character varying))::text || ' '::text) || COALESCE(description, ''::text))),
  CONSTRAINT detail_standards_pkey PRIMARY KEY (detail_id),
  CONSTRAINT detail_standards_block_id_fkey FOREIGN KEY (block_id) REFERENCES public.block_definitions(block_id)
);
CREATE TABLE public.detail_standards_backup (
  detail_id uuid,
  block_id uuid,
  detail_number character varying,
  detail_title character varying,
  detail_category character varying,
  applicable_layers ARRAY,
  applicable_symbols ARRAY,
  scale character varying,
  description text,
  usage_context text,
  typical_application text,
  code_references ARRAY,
  metadata jsonb,
  created_at timestamp without time zone
);
CREATE TABLE public.dimension_styles (
  dimstyle_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  style_name character varying NOT NULL UNIQUE,
  text_style_id uuid,
  arrow_type character varying DEFAULT 'CLOSED_FILLED'::character varying,
  arrow_size double precision DEFAULT 0.18,
  tick_size double precision DEFAULT 0.09,
  text_height double precision DEFAULT 0.12,
  text_gap double precision DEFAULT 0.09,
  text_above_line boolean DEFAULT true,
  text_color integer DEFAULT 7,
  extension_line_offset double precision DEFAULT 0.0625,
  extension_line_extend double precision DEFAULT 0.18,
  dimension_line_color integer DEFAULT 7,
  extension_line_color integer DEFAULT 7,
  overall_scale double precision DEFAULT 1.0,
  usage_context text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT dimension_styles_pkey PRIMARY KEY (dimstyle_id),
  CONSTRAINT dimension_styles_text_style_id_fkey FOREIGN KEY (text_style_id) REFERENCES public.text_styles(style_id)
);
CREATE TABLE public.drawing_dimensions (
  dimension_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid NOT NULL,
  layer_id uuid,
  dimension_type character varying NOT NULL,
  dxf_handle character varying,
  definition_point USER-DEFINED,
  text_position USER-DEFINED,
  geometry USER-DEFINED,
  measured_value numeric,
  override_value character varying,
  dimension_style character varying,
  dimension_style_id uuid,
  color_aci integer,
  text_height numeric,
  arrow_size numeric,
  properties jsonb,
  space_type character varying DEFAULT 'MODEL'::character varying,
  layout_name character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  metadata jsonb,
  CONSTRAINT drawing_dimensions_pkey PRIMARY KEY (dimension_id),
  CONSTRAINT drawing_dimensions_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT drawing_dimensions_layer_id_fkey FOREIGN KEY (layer_id) REFERENCES public.layers(layer_id),
  CONSTRAINT drawing_dimensions_dimension_style_id_fkey FOREIGN KEY (dimension_style_id) REFERENCES public.dimension_styles(dimstyle_id)
);
CREATE TABLE public.drawing_entities (
  entity_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid NOT NULL,
  layer_id uuid,
  entity_type character varying NOT NULL,
  dxf_handle character varying,
  geometry USER-DEFINED,
  color_aci integer,
  linetype character varying,
  lineweight numeric,
  transparency integer DEFAULT 0,
  properties jsonb,
  space_type character varying DEFAULT 'MODEL'::character varying,
  layout_name character varying,
  visibility boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  metadata jsonb,
  CONSTRAINT drawing_entities_pkey PRIMARY KEY (entity_id),
  CONSTRAINT drawing_entities_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT drawing_entities_layer_id_fkey FOREIGN KEY (layer_id) REFERENCES public.layers(layer_id)
);
CREATE TABLE public.drawing_hatches (
  hatch_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid NOT NULL,
  layer_id uuid,
  pattern_name character varying,
  pattern_id uuid,
  dxf_handle character varying,
  boundary_geometry USER-DEFINED,
  pattern_type character varying,
  pattern_scale numeric DEFAULT 1.0,
  pattern_angle numeric DEFAULT 0,
  pattern_spacing numeric,
  color_aci integer,
  is_solid boolean DEFAULT false,
  transparency integer DEFAULT 0,
  is_associative boolean DEFAULT true,
  associated_entities ARRAY,
  space_type character varying DEFAULT 'MODEL'::character varying,
  layout_name character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  metadata jsonb,
  CONSTRAINT drawing_hatches_pkey PRIMARY KEY (hatch_id),
  CONSTRAINT drawing_hatches_pattern_id_fkey FOREIGN KEY (pattern_id) REFERENCES public.hatch_patterns(hatch_id),
  CONSTRAINT drawing_hatches_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT drawing_hatches_layer_id_fkey FOREIGN KEY (layer_id) REFERENCES public.layers(layer_id)
);
CREATE TABLE public.drawing_layer_usage (
  usage_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid NOT NULL,
  layer_id uuid NOT NULL,
  layer_standard_id uuid,
  entity_count integer DEFAULT 0,
  last_used_at timestamp without time zone,
  override_color integer,
  override_linetype character varying,
  override_lineweight numeric,
  is_frozen boolean DEFAULT false,
  is_locked boolean DEFAULT false,
  is_plottable boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT drawing_layer_usage_pkey PRIMARY KEY (usage_id),
  CONSTRAINT drawing_layer_usage_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT drawing_layer_usage_layer_id_fkey FOREIGN KEY (layer_id) REFERENCES public.layers(layer_id),
  CONSTRAINT drawing_layer_usage_layer_standard_id_fkey FOREIGN KEY (layer_standard_id) REFERENCES public.layer_standards(layer_standard_id)
);
CREATE TABLE public.drawing_linetype_usage (
  usage_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid NOT NULL,
  linetype_name character varying NOT NULL,
  linetype_standard_id uuid,
  usage_count integer DEFAULT 0,
  last_used_at timestamp without time zone,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT drawing_linetype_usage_pkey PRIMARY KEY (usage_id),
  CONSTRAINT drawing_linetype_usage_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT drawing_linetype_usage_linetype_standard_id_fkey FOREIGN KEY (linetype_standard_id) REFERENCES public.linetype_standards(linetype_id)
);
CREATE TABLE public.drawing_scale_standards (
  scale_id integer NOT NULL DEFAULT nextval('drawing_scale_standards_scale_id_seq'::regclass),
  scale_name character varying NOT NULL,
  scale_text character varying NOT NULL,
  scale_factor numeric NOT NULL,
  scale_type character varying,
  discipline character varying,
  typical_usage text,
  min_text_height numeric,
  recommended_sheet_size character varying,
  is_preferred boolean DEFAULT false,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT drawing_scale_standards_pkey PRIMARY KEY (scale_id)
);
CREATE TABLE public.drawing_text (
  text_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid NOT NULL,
  layer_id uuid,
  text_content text NOT NULL,
  dxf_handle character varying,
  insertion_point USER-DEFINED,
  alignment_point USER-DEFINED,
  text_height numeric,
  rotation_angle numeric DEFAULT 0,
  width_factor numeric DEFAULT 1.0,
  oblique_angle numeric DEFAULT 0,
  text_style character varying,
  font_name character varying,
  horizontal_justification character varying,
  vertical_justification character varying,
  color_aci integer,
  layer_name character varying,
  space_type character varying DEFAULT 'MODEL'::character varying,
  layout_name character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  metadata jsonb,
  CONSTRAINT drawing_text_pkey PRIMARY KEY (text_id),
  CONSTRAINT drawing_text_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT drawing_text_layer_id_fkey FOREIGN KEY (layer_id) REFERENCES public.layers(layer_id)
);
CREATE TABLE public.drawing_versions (
  version_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid,
  version_number integer NOT NULL,
  dxf_content text,
  modified_by character varying,
  modified_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  change_description text,
  CONSTRAINT drawing_versions_pkey PRIMARY KEY (version_id),
  CONSTRAINT drawing_versions_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id)
);
CREATE TABLE public.drawings (
  drawing_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  drawing_name character varying NOT NULL,
  drawing_number character varying,
  description text,
  drawing_type character varying,
  scale character varying,
  dxf_content text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  current_version integer DEFAULT 1,
  drawing_embedding USER-DEFINED,
  summary text,
  tags ARRAY,
  metadata jsonb,
  file_path character varying,
  file_size bigint,
  drawing_coordinate_system character varying,
  drawing_epsg_code integer,
  cad_units character varying,
  scale_factor double precision DEFAULT 1.0,
  rotation_angle double precision DEFAULT 0.0,
  translation_x double precision DEFAULT 0.0,
  translation_y double precision DEFAULT 0.0,
  is_georeferenced boolean DEFAULT false,
  georeferencing_notes text,
  georef_point USER-DEFINED,
  CONSTRAINT drawings_pkey PRIMARY KEY (drawing_id),
  CONSTRAINT drawings_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.earthwork_balance (
  balance_id uuid NOT NULL DEFAULT gen_random_uuid(),
  alignment_id uuid,
  station numeric,
  cumulative_volume numeric,
  mass_ordinate numeric,
  balance_point boolean DEFAULT false,
  free_haul_limit numeric,
  CONSTRAINT earthwork_balance_pkey PRIMARY KEY (balance_id),
  CONSTRAINT earthwork_balance_alignment_id_fkey FOREIGN KEY (alignment_id) REFERENCES public.horizontal_alignments(alignment_id)
);
CREATE TABLE public.earthwork_quantities (
  earthwork_id uuid NOT NULL DEFAULT gen_random_uuid(),
  alignment_id uuid,
  start_station numeric,
  end_station numeric,
  material_type character varying,
  cut_volume numeric,
  fill_volume numeric,
  net_volume numeric,
  shrink_swell numeric DEFAULT 1.0,
  haul_distance numeric,
  overhaul numeric,
  unit_cost numeric,
  total_cost numeric,
  notes text,
  CONSTRAINT earthwork_quantities_pkey PRIMARY KEY (earthwork_id),
  CONSTRAINT earthwork_quantities_alignment_id_fkey FOREIGN KEY (alignment_id) REFERENCES public.horizontal_alignments(alignment_id)
);
CREATE TABLE public.easements (
  easement_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  drawing_id uuid,
  easement_number character varying,
  easement_type character varying,
  easement_purpose text,
  grantor character varying,
  grantee character varying,
  recording_info character varying,
  recorded_date date,
  width numeric,
  boundary_geometry USER-DEFINED NOT NULL,
  area_sqft numeric,
  notes text,
  attributes jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT easements_pkey PRIMARY KEY (easement_id),
  CONSTRAINT easements_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT easements_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id)
);
CREATE TABLE public.embeddings (
  embedding_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  entity_type character varying NOT NULL,
  entity_id uuid NOT NULL,
  embedding_model character varying,
  embedding USER-DEFINED,
  text_content text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  confidence double precision DEFAULT 1.0,
  source character varying DEFAULT 'manual'::character varying,
  CONSTRAINT embeddings_pkey PRIMARY KEY (embedding_id)
);
CREATE TABLE public.entity_relationships (
  relationship_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  source_type character varying NOT NULL,
  source_id uuid NOT NULL,
  target_type character varying NOT NULL,
  target_id uuid NOT NULL,
  relationship_type character varying NOT NULL,
  distance double precision,
  semantic_description text,
  confidence double precision,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  metadata jsonb,
  source character varying DEFAULT 'manual'::character varying,
  verified boolean DEFAULT false,
  CONSTRAINT entity_relationships_pkey PRIMARY KEY (relationship_id)
);
CREATE TABLE public.entity_semantics (
  semantic_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  entity_type character varying NOT NULL,
  entity_id uuid NOT NULL,
  semantic_class character varying,
  semantic_label character varying,
  description text,
  properties jsonb,
  confidence double precision DEFAULT 1.0,
  source character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT entity_semantics_pkey PRIMARY KEY (semantic_id)
);
CREATE TABLE public.entity_tags (
  entity_type character varying NOT NULL,
  entity_id uuid NOT NULL,
  tag_id uuid NOT NULL,
  added_by character varying,
  added_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT entity_tags_pkey PRIMARY KEY (entity_type, entity_id, tag_id),
  CONSTRAINT entity_tags_tag_id_fkey FOREIGN KEY (tag_id) REFERENCES public.tags(tag_id)
);
CREATE TABLE public.export_jobs (
  job_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid,
  project_id uuid,
  export_format character varying NOT NULL,
  dxf_version character varying,
  export_scope character varying,
  selected_drawings ARRAY,
  layer_filter ARRAY,
  entity_types_filter ARRAY,
  coordinate_system character varying,
  apply_georeferencing boolean DEFAULT true,
  include_spatial_index boolean DEFAULT false,
  include_layouts boolean DEFAULT true,
  include_blocks boolean DEFAULT true,
  include_xrefs boolean DEFAULT false,
  merge_layers boolean DEFAULT false,
  status character varying DEFAULT 'PENDING'::character varying,
  started_at timestamp without time zone,
  completed_at timestamp without time zone,
  created_by character varying,
  output_file_path character varying,
  output_file_size bigint,
  output_file_hash character varying,
  entities_exported integer,
  layers_exported integer,
  blocks_exported integer,
  processing_time_ms integer,
  error_message text,
  warnings ARRAY,
  export_parameters jsonb,
  processing_log jsonb,
  metadata jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT export_jobs_pkey PRIMARY KEY (job_id),
  CONSTRAINT export_jobs_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT export_jobs_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.fact_graph (
  fact_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  subject_type text NOT NULL,
  subject_id uuid NOT NULL,
  predicate text NOT NULL,
  object_type text,
  object_value text,
  confidence numeric DEFAULT 1.0,
  metadata jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  strength numeric DEFAULT 1.0,
  source character varying DEFAULT 'manual'::character varying,
  CONSTRAINT fact_graph_pkey PRIMARY KEY (fact_id)
);
CREATE TABLE public.field_defaults (
  default_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  target_table character varying NOT NULL,
  target_field character varying NOT NULL,
  condition_field character varying,
  condition_operator character varying,
  condition_value text,
  default_value text NOT NULL,
  default_value_type character varying NOT NULL,
  priority integer DEFAULT 100,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  deleted_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  notes text,
  CONSTRAINT field_defaults_pkey PRIMARY KEY (default_id)
);
CREATE TABLE public.geometry_fingerprints (
  fingerprint_id uuid NOT NULL DEFAULT gen_random_uuid(),
  object_type character varying NOT NULL,
  object_id uuid NOT NULL,
  coarse_hash character varying NOT NULL,
  coordinate_hash character varying NOT NULL,
  attribute_hash character varying,
  semantic_hash character varying,
  full_fingerprint character varying DEFAULT encode(sha256((((((coarse_hash)::text || (coordinate_hash)::text) || (COALESCE(attribute_hash, ''::character varying))::text) || (COALESCE(semantic_hash, ''::character varying))::text))::bytea), 'hex'::text),
  tolerance_ft numeric DEFAULT 0.01,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  raw_geometry_wkt text,
  raw_attributes jsonb,
  CONSTRAINT geometry_fingerprints_pkey PRIMARY KEY (fingerprint_id)
);
CREATE TABLE public.gis_layers (
  id text NOT NULL,
  county_id text,
  name text NOT NULL,
  layer_type text NOT NULL,
  url text,
  layer_name text,
  style jsonb,
  enabled boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT now(),
  updated_at timestamp without time zone DEFAULT now(),
  CONSTRAINT gis_layers_pkey PRIMARY KEY (id)
);
CREATE TABLE public.glossary_terms (
  term_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  term character varying NOT NULL UNIQUE,
  definition text NOT NULL,
  category character varying,
  synonyms ARRAY,
  related_terms ARRAY,
  usage_examples ARRAY,
  source character varying DEFAULT 'COS_Glossary'::character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT glossary_terms_pkey PRIMARY KEY (term_id)
);
CREATE TABLE public.grading_limits (
  limit_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  drawing_id uuid,
  limit_name character varying NOT NULL,
  limit_type character varying,
  boundary_geometry USER-DEFINED NOT NULL,
  area_sqft numeric,
  area_acres numeric,
  max_allowed_area_acres numeric,
  approval_status character varying,
  permit_number character varying,
  approved_by character varying,
  approval_date date,
  expiration_date date,
  description text,
  notes text,
  attributes jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT grading_limits_pkey PRIMARY KEY (limit_id),
  CONSTRAINT grading_limits_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT grading_limits_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id)
);
CREATE TABLE public.hatch_patterns (
  hatch_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  pattern_name character varying NOT NULL UNIQUE,
  pattern_type character varying NOT NULL,
  angle double precision DEFAULT 0,
  scale double precision DEFAULT 1.0,
  pattern_definition text,
  material_type character varying,
  description text,
  usage_context text,
  svg_preview text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT hatch_patterns_pkey PRIMARY KEY (hatch_id)
);
CREATE TABLE public.horizontal_alignments (
  alignment_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  alignment_name character varying NOT NULL,
  description text,
  alignment_type character varying,
  design_speed numeric,
  alignment_geometry USER-DEFINED,
  start_station numeric,
  end_station numeric,
  created_by character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  geometry_status character varying DEFAULT 'DRAFT'::character varying,
  is_closed boolean DEFAULT false,
  total_length numeric,
  validation_status character varying DEFAULT 'PENDING'::character varying,
  validation_errors jsonb DEFAULT '[]'::jsonb,
  validation_warnings jsonb DEFAULT '[]'::jsonb,
  last_validated_at timestamp with time zone,
  CONSTRAINT horizontal_alignments_pkey PRIMARY KEY (alignment_id),
  CONSTRAINT horizontal_alignments_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.horizontal_elements (
  element_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  alignment_id uuid,
  type text CHECK (type = ANY (ARRAY['tangent'::text, 'curve'::text, 'spiral'::text])),
  params jsonb,
  start_station numeric,
  end_station numeric,
  CONSTRAINT horizontal_elements_pkey PRIMARY KEY (element_id),
  CONSTRAINT horizontal_elements_alignment_id_fkey FOREIGN KEY (alignment_id) REFERENCES public.alignments(alignment_id)
);
CREATE TABLE public.illegal_combinations (
  rule_id uuid NOT NULL DEFAULT gen_random_uuid(),
  combination_type character varying NOT NULL,
  token character varying,
  geometry_class character varying,
  view_context character varying,
  phase character varying,
  subtype_id uuid,
  is_forbidden boolean DEFAULT true,
  severity character varying DEFAULT 'error'::character varying,
  error_code character varying NOT NULL,
  rationale text NOT NULL,
  correct_alternative text,
  example_violation text,
  allowed_in_contexts ARRAY,
  requires_justification boolean DEFAULT false,
  status character varying DEFAULT 'active'::character varying,
  effective_date date DEFAULT CURRENT_DATE,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT illegal_combinations_pkey PRIMARY KEY (rule_id)
);
CREATE TABLE public.import_attributes (
  attribute_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  entity_id uuid NOT NULL,
  extraction_source character varying NOT NULL CHECK (extraction_source::text = ANY (ARRAY['XDATA'::character varying, 'ATTRIB'::character varying, 'TEXT'::character varying, 'MTEXT'::character varying, 'COMPUTED'::character varying, 'DEFAULT'::character varying]::text[])),
  extraction_pattern character varying,
  cad_field_name character varying NOT NULL,
  raw_value text NOT NULL,
  raw_value_type character varying,
  mapped_field character varying,
  mapped_value text,
  mapped_value_type character varying,
  source_units character varying,
  target_units character varying,
  conversion_applied boolean DEFAULT false,
  extraction_confidence integer DEFAULT 100 CHECK (extraction_confidence >= 0 AND extraction_confidence <= 100),
  mapping_confidence integer DEFAULT 100 CHECK (mapping_confidence >= 0 AND mapping_confidence <= 100),
  is_valid boolean DEFAULT true,
  validation_errors ARRAY,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  deleted_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT import_attributes_pkey PRIMARY KEY (attribute_id),
  CONSTRAINT import_attributes_entity_id_fkey FOREIGN KEY (entity_id) REFERENCES public.import_entities(entity_id)
);
CREATE TABLE public.import_entities (
  entity_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  session_id uuid NOT NULL,
  cad_handle character varying,
  cad_layer character varying NOT NULL,
  cad_entity_type character varying NOT NULL,
  cad_color_aci integer,
  cad_linetype character varying,
  layer_discipline character varying,
  layer_category character varying,
  layer_object_token character varying,
  layer_phase character varying,
  layer_geometry_class character varying,
  layer_context character varying,
  layer_parse_success boolean DEFAULT false,
  layer_parse_errors ARRAY,
  raw_geometry USER-DEFINED,
  raw_geometry_type character varying,
  geometry_srid integer DEFAULT 2227,
  target_table character varying,
  target_object_type character varying,
  status character varying NOT NULL DEFAULT 'PENDING'::character varying CHECK (status::text = ANY (ARRAY['PENDING'::character varying, 'ACCEPTED'::character varying, 'REVIEWING'::character varying, 'REJECTED'::character varying, 'APPROVED'::character varying, 'INSERTED'::character varying]::text[])),
  overall_confidence_score integer CHECK (overall_confidence_score >= 0 AND overall_confidence_score <= 100),
  extraction_score integer CHECK (extraction_score >= 0 AND extraction_score <= 100),
  relationship_score integer CHECK (relationship_score >= 0 AND relationship_score <= 100),
  mapping_score integer CHECK (mapping_score >= 0 AND mapping_score <= 100),
  validation_score integer CHECK (validation_score >= 0 AND validation_score <= 100),
  auto_accepted boolean DEFAULT false,
  rejection_reason text,
  review_notes text,
  inserted_id uuid,
  inserted_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  deleted_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT import_entities_pkey PRIMARY KEY (entity_id),
  CONSTRAINT import_entities_session_id_fkey FOREIGN KEY (session_id) REFERENCES public.import_sessions(session_id)
);
CREATE TABLE public.import_manual_overrides (
  override_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  entity_id uuid NOT NULL,
  original_status character varying NOT NULL,
  new_status character varying NOT NULL CHECK (new_status::text = ANY (ARRAY['APPROVED'::character varying, 'REJECTED'::character varying, 'MODIFIED'::character varying]::text[])),
  reviewed_by character varying NOT NULL,
  reviewed_at timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  decision_reason character varying,
  review_notes text,
  modified_attributes jsonb,
  modified_relationships jsonb,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  deleted_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT import_manual_overrides_pkey PRIMARY KEY (override_id),
  CONSTRAINT import_manual_overrides_entity_id_fkey FOREIGN KEY (entity_id) REFERENCES public.import_entities(entity_id)
);
CREATE TABLE public.import_relationships (
  relationship_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  session_id uuid NOT NULL,
  from_entity_id uuid NOT NULL,
  to_entity_id uuid NOT NULL,
  relationship_type character varying NOT NULL CHECK (relationship_type::text = ANY (ARRAY['PIPE_TO_STRUCTURE'::character varying, 'STRUCTURE_PROXIMITY'::character varying, 'PIPE_CONTINUITY'::character varying, 'TEXT_ANNOTATION'::character varying, 'SPATIAL_OVERLAP'::character varying]::text[])),
  distance_ft numeric CHECK (distance_ft >= 0::numeric),
  angle_degrees numeric CHECK (angle_degrees >= 0::numeric AND angle_degrees <= 360::numeric),
  connection_end character varying CHECK (connection_end::text = ANY (ARRAY['UPSTREAM'::character varying, 'DOWNSTREAM'::character varying, 'BOTH'::character varying]::text[])),
  is_inferred boolean DEFAULT true,
  relationship_confidence integer DEFAULT 0 CHECK (relationship_confidence >= 0 AND relationship_confidence <= 100),
  confidence_factors jsonb,
  is_valid boolean DEFAULT true,
  validation_errors ARRAY,
  validation_warnings ARRAY,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  deleted_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT import_relationships_pkey PRIMARY KEY (relationship_id),
  CONSTRAINT import_relationships_session_id_fkey FOREIGN KEY (session_id) REFERENCES public.import_sessions(session_id),
  CONSTRAINT import_relationships_from_entity_id_fkey FOREIGN KEY (from_entity_id) REFERENCES public.import_entities(entity_id),
  CONSTRAINT import_relationships_to_entity_id_fkey FOREIGN KEY (to_entity_id) REFERENCES public.import_entities(entity_id)
);
CREATE TABLE public.import_sessions (
  session_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid NOT NULL,
  organization_id uuid,
  user_id uuid,
  source_file_name character varying NOT NULL,
  source_file_path text,
  source_file_size bigint,
  source_file_hash character varying,
  source_file_format character varying DEFAULT 'DXF'::character varying,
  confidence_threshold integer DEFAULT 80 CHECK (confidence_threshold >= 0 AND confidence_threshold <= 100),
  validation_mode character varying DEFAULT 'STRICT'::character varying CHECK (validation_mode::text = ANY (ARRAY['STRICT'::character varying, 'LENIENT'::character varying, 'PERMISSIVE'::character varying]::text[])),
  auto_accept_enabled boolean DEFAULT true,
  status character varying NOT NULL DEFAULT 'PENDING'::character varying CHECK (status::text = ANY (ARRAY['PENDING'::character varying, 'PARSING'::character varying, 'EXTRACTING'::character varying, 'VALIDATING'::character varying, 'SCORING'::character varying, 'REVIEWING'::character varying, 'INSERTING'::character varying, 'COMPLETED'::character varying, 'FAILED'::character varying, 'CANCELLED'::character varying]::text[])),
  total_entities integer DEFAULT 0,
  accepted_count integer DEFAULT 0,
  reviewing_count integer DEFAULT 0,
  rejected_count integer DEFAULT 0,
  started_at timestamp with time zone,
  completed_at timestamp with time zone,
  duration_seconds integer,
  error_message text,
  warnings ARRAY,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  deleted_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT import_sessions_pkey PRIMARY KEY (session_id),
  CONSTRAINT import_sessions_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.import_validation_log (
  log_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  session_id uuid NOT NULL,
  entity_id uuid,
  validation_level character varying NOT NULL CHECK (validation_level::text = ANY (ARRAY['FILE'::character varying, 'ENTITY'::character varying, 'RELATIONSHIP'::character varying]::text[])),
  rule_code character varying NOT NULL,
  rule_name character varying NOT NULL,
  severity character varying NOT NULL CHECK (severity::text = ANY (ARRAY['CRITICAL'::character varying, 'ERROR'::character varying, 'WARNING'::character varying, 'INFO'::character varying]::text[])),
  passed boolean NOT NULL,
  message text NOT NULL,
  details jsonb,
  expected_value text,
  actual_value text,
  can_auto_fix boolean DEFAULT false,
  suggested_fix text,
  validated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  deleted_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT import_validation_log_pkey PRIMARY KEY (log_id),
  CONSTRAINT import_validation_log_session_id_fkey FOREIGN KEY (session_id) REFERENCES public.import_sessions(session_id),
  CONSTRAINT import_validation_log_entity_id_fkey FOREIGN KEY (entity_id) REFERENCES public.import_entities(entity_id)
);
CREATE TABLE public.inspections (
  inspection_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  bmp_id uuid,
  date date,
  findings text,
  status text CHECK (status = ANY (ARRAY['pass'::text, 'fail'::text])),
  follow_up text,
  CONSTRAINT inspections_pkey PRIMARY KEY (inspection_id),
  CONSTRAINT inspections_bmp_id_fkey FOREIGN KEY (bmp_id) REFERENCES public.bmps(bmp_id)
);
CREATE TABLE public.layer_detail_relationships (
  relationship_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  layer_name character varying NOT NULL,
  primary_details ARRAY,
  related_details ARRAY,
  critical_standard character varying,
  callout_example text,
  confidence double precision DEFAULT 1.0,
  source character varying DEFAULT 'COS_CrossRef'::character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT layer_detail_relationships_pkey PRIMARY KEY (relationship_id)
);
CREATE TABLE public.layer_name_mapping (
  old_layer_name character varying,
  new_layer_name character varying,
  old_layer_standard_id uuid,
  new_layer_standard_id uuid,
  mapping_notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE public.layer_standards (
  layer_standard_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  layer_name character varying NOT NULL UNIQUE,
  discipline character varying,
  category character varying NOT NULL,
  type character varying DEFAULT 'CUSTOM'::character varying,
  status character varying DEFAULT 'ACTIVE'::character varying CHECK (status::text = ANY (ARRAY['EXISTING'::character varying, 'PROPOSED'::character varying, 'DEMO'::character varying, 'TEMP'::character varying, 'FOUND'::character varying, 'SET'::character varying, 'STANDARD'::character varying]::text[])),
  color integer DEFAULT 7 CHECK (color >= 1 AND color <= 255),
  color_rgb character varying,
  linetype character varying DEFAULT 'CONTINUOUS'::character varying,
  lineweight double precision DEFAULT 0.25,
  is_plottable boolean DEFAULT true,
  is_locked boolean DEFAULT false,
  plot_style character varying,
  transparency integer DEFAULT 0 CHECK (transparency >= 0 AND transparency <= 90),
  description text,
  usage_context text,
  display_order integer,
  layer_embedding USER-DEFINED,
  tags ARRAY,
  standard_reference character varying DEFAULT 'CUSTOM'::character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  metadata jsonb,
  detail_series character varying,
  primary_abbreviations ARRAY,
  color_name character varying,
  notes text,
  CONSTRAINT layer_standards_pkey PRIMARY KEY (layer_standard_id)
);
CREATE TABLE public.layer_standards_backup (
  layer_standard_id uuid,
  layer_name character varying,
  discipline character varying,
  category character varying,
  type character varying,
  status character varying,
  color integer,
  color_rgb character varying,
  linetype character varying,
  lineweight double precision,
  is_plottable boolean,
  is_locked boolean,
  plot_style character varying,
  transparency integer,
  description text,
  usage_context text,
  display_order integer,
  layer_embedding USER-DEFINED,
  tags ARRAY,
  standard_reference character varying,
  created_at timestamp without time zone,
  updated_at timestamp without time zone,
  metadata jsonb
);
CREATE TABLE public.layer_symbol_rules (
  rule_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  layer_standard_id uuid,
  block_id uuid,
  relationship_type character varying NOT NULL CHECK (relationship_type::text = ANY (ARRAY['REQUIRED'::character varying, 'RECOMMENDED'::character varying, 'ALLOWED'::character varying, 'FORBIDDEN'::character varying]::text[])),
  rule_description text,
  confidence double precision DEFAULT 1.0,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT layer_symbol_rules_pkey PRIMARY KEY (rule_id),
  CONSTRAINT layer_symbol_rules_layer_standard_id_fkey FOREIGN KEY (layer_standard_id) REFERENCES public.layer_standards(layer_standard_id),
  CONSTRAINT layer_symbol_rules_block_id_fkey FOREIGN KEY (block_id) REFERENCES public.block_definitions(block_id)
);
CREATE TABLE public.layers (
  layer_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid,
  layer_name character varying NOT NULL,
  color integer,
  linetype character varying DEFAULT 'CONTINUOUS'::character varying,
  semantic_category character varying,
  description text,
  tags ARRAY,
  layer_standard_id uuid,
  lineweight double precision DEFAULT 0.25,
  is_plottable boolean DEFAULT true,
  is_locked boolean DEFAULT false,
  is_frozen boolean DEFAULT false,
  transparency integer DEFAULT 0,
  usage_context text,
  layer_embedding USER-DEFINED,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  metadata jsonb,
  CONSTRAINT layers_pkey PRIMARY KEY (layer_id),
  CONSTRAINT layers_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT layers_layer_standard_id_fkey FOREIGN KEY (layer_standard_id) REFERENCES public.layer_standards(layer_standard_id)
);
CREATE TABLE public.layers_backup (
  layer_id uuid,
  drawing_id uuid,
  layer_name character varying,
  color integer,
  linetype character varying,
  semantic_category character varying,
  description text,
  tags ARRAY,
  layer_standard_id uuid,
  lineweight double precision,
  is_plottable boolean,
  is_locked boolean,
  is_frozen boolean,
  transparency integer,
  usage_context text,
  layer_embedding USER-DEFINED,
  created_at timestamp without time zone,
  updated_at timestamp without time zone,
  metadata jsonb
);
CREATE TABLE public.layout_viewports (
  viewport_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid NOT NULL,
  layout_name character varying NOT NULL,
  viewport_number integer,
  dxf_handle character varying,
  center_point USER-DEFINED,
  width numeric,
  height numeric,
  view_center USER-DEFINED,
  view_height numeric,
  scale_factor numeric,
  viewport_scale character varying,
  viewport_standard_id integer,
  view_twist_angle numeric DEFAULT 0,
  lens_length numeric,
  front_clip numeric,
  back_clip numeric,
  is_active boolean DEFAULT true,
  display_locked boolean DEFAULT false,
  layers_frozen ARRAY,
  visual_style character varying,
  grid_on boolean DEFAULT false,
  snap_on boolean DEFAULT false,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  metadata jsonb,
  CONSTRAINT layout_viewports_pkey PRIMARY KEY (viewport_id),
  CONSTRAINT layout_viewports_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT layout_viewports_viewport_standard_id_fkey FOREIGN KEY (viewport_standard_id) REFERENCES public.viewport_standards(viewport_id)
);
CREATE TABLE public.linetype_standards (
  linetype_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  linetype_name character varying NOT NULL UNIQUE,
  description text,
  pattern text,
  dxf_pattern text,
  scale_factor double precision DEFAULT 1.0,
  usage_context text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT linetype_standards_pkey PRIMARY KEY (linetype_id)
);
CREATE TABLE public.maintenance_records (
  record_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  bmp_id uuid,
  date date,
  action text,
  notes text,
  CONSTRAINT maintenance_records_pkey PRIMARY KEY (record_id),
  CONSTRAINT maintenance_records_bmp_id_fkey FOREIGN KEY (bmp_id) REFERENCES public.bmps(bmp_id)
);
CREATE TABLE public.mapping_audit_log (
  log_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  session_id uuid NOT NULL,
  entity_id uuid,
  action_type character varying NOT NULL CHECK (action_type::text = ANY (ARRAY['FIELD_MAPPED'::character varying, 'TYPE_CONVERTED'::character varying, 'UNIT_CONVERTED'::character varying, 'VOCABULARY_NORMALIZED'::character varying, 'DEFAULT_APPLIED'::character varying, 'SYNONYM_RESOLVED'::character varying]::text[])),
  source_field character varying,
  source_value text,
  target_field character varying,
  target_value text,
  mapping_id uuid,
  mapping_scope character varying,
  conversion_applied character varying,
  mapping_confidence integer CHECK (mapping_confidence >= 0 AND mapping_confidence <= 100),
  mapped_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  deleted_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT mapping_audit_log_pkey PRIMARY KEY (log_id),
  CONSTRAINT mapping_audit_log_session_id_fkey FOREIGN KEY (session_id) REFERENCES public.import_sessions(session_id),
  CONSTRAINT mapping_audit_log_entity_id_fkey FOREIGN KEY (entity_id) REFERENCES public.import_entities(entity_id)
);
CREATE TABLE public.material_standards (
  material_id integer NOT NULL DEFAULT nextval('material_standards_material_id_seq'::regclass),
  material_name character varying NOT NULL,
  material_code character varying,
  category character varying,
  hatch_pattern_id uuid,
  color_id uuid,
  description text,
  specifications text,
  typical_uses text,
  code_references ARRAY,
  unit_cost numeric,
  unit_type character varying,
  tags ARRAY,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT material_standards_pkey PRIMARY KEY (material_id),
  CONSTRAINT material_standards_hatch_pattern_id_fkey FOREIGN KEY (hatch_pattern_id) REFERENCES public.hatch_patterns(hatch_id),
  CONSTRAINT material_standards_color_id_fkey FOREIGN KEY (color_id) REFERENCES public.color_standards(color_id)
);
CREATE TABLE public.note_block_type_associations (
  association_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  standard_note_id integer,
  block_name text,
  association_strength text CHECK (association_strength = ANY (ARRAY['required'::text, 'recommended'::text, 'optional'::text])),
  discipline text,
  description text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT note_block_type_associations_pkey PRIMARY KEY (association_id),
  CONSTRAINT note_block_type_associations_standard_note_id_fkey FOREIGN KEY (standard_note_id) REFERENCES public.standard_notes(note_id)
);
CREATE TABLE public.note_callouts (
  callout_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid,
  layout_name text,
  project_note_id uuid,
  position_x double precision,
  position_y double precision,
  position_z double precision DEFAULT 0,
  explains_insert_id uuid,
  notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT note_callouts_pkey PRIMARY KEY (callout_id),
  CONSTRAINT note_callouts_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT note_callouts_project_note_id_fkey FOREIGN KEY (project_note_id) REFERENCES public.project_sheet_notes(project_note_id),
  CONSTRAINT note_callouts_explains_insert_id_fkey FOREIGN KEY (explains_insert_id) REFERENCES public.block_inserts(insert_id)
);
CREATE TABLE public.obj_attributes (
  attribute_id uuid NOT NULL DEFAULT gen_random_uuid(),
  attribute_name character varying NOT NULL UNIQUE,
  applicable_tokens ARRAY,
  applicable_subtypes ARRAY,
  data_type character varying NOT NULL,
  validation_regex character varying,
  min_value numeric,
  max_value numeric,
  allowed_values ARRAY,
  is_required boolean DEFAULT false,
  is_computed boolean DEFAULT false,
  computation_formula text,
  definition text NOT NULL,
  units character varying,
  typical_values_example text,
  source_system character varying,
  is_instance_specific boolean DEFAULT true,
  is_project_specific boolean DEFAULT false,
  status character varying DEFAULT 'active'::character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT obj_attributes_pkey PRIMARY KEY (attribute_id)
);
CREATE TABLE public.obj_subtypes (
  subtype_id uuid NOT NULL DEFAULT gen_random_uuid(),
  parent_token character varying NOT NULL,
  subtype_code character varying NOT NULL,
  subtype_category character varying,
  affects_hydraulics boolean DEFAULT false,
  affects_structural boolean DEFAULT false,
  affects_compliance boolean DEFAULT false,
  separate_spec_line boolean DEFAULT false,
  typical_unit_cost_multiplier numeric,
  definition text NOT NULL,
  typical_applications ARRAY,
  code_references ARRAY,
  incompatible_with ARRAY,
  requires_attributes ARRAY,
  usage_count integer DEFAULT 0,
  project_ids ARRAY,
  tier_promotion_date date,
  tier_promotion_justification text,
  status character varying DEFAULT 'active'::character varying,
  superseded_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  reviewed_at timestamp with time zone,
  reviewed_by character varying,
  CONSTRAINT obj_subtypes_pkey PRIMARY KEY (subtype_id),
  CONSTRAINT obj_subtypes_parent_token_fkey FOREIGN KEY (parent_token) REFERENCES public.obj_tokens(token)
);
CREATE TABLE public.obj_synonyms (
  synonym_id uuid NOT NULL DEFAULT gen_random_uuid(),
  synonym_tier integer NOT NULL CHECK (synonym_tier = ANY (ARRAY[1, 2])),
  synonym character varying NOT NULL,
  canonical_token character varying,
  canonical_subtype_id uuid,
  discipline_context character varying,
  category_context character varying,
  confidence_score numeric DEFAULT 1.0,
  authority_source character varying,
  conflicts_with ARRAY,
  resolution_notes text,
  usage_count integer DEFAULT 0,
  last_used timestamp with time zone,
  status character varying DEFAULT 'active'::character varying,
  approved_at timestamp with time zone,
  approved_by character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT obj_synonyms_pkey PRIMARY KEY (synonym_id)
);
CREATE TABLE public.obj_tokens (
  token_id uuid NOT NULL DEFAULT gen_random_uuid(),
  token character varying NOT NULL UNIQUE,
  discipline character varying NOT NULL,
  category character varying NOT NULL,
  cad_entity_type character varying NOT NULL,
  requires_special_validation boolean DEFAULT false,
  has_custom_export_logic boolean DEFAULT false,
  primary_table character varying,
  geometry_type character varying,
  definition text NOT NULL,
  cross_discipline_recognized boolean DEFAULT true,
  appears_in_standards ARRAY,
  usage_count integer DEFAULT 0,
  last_used timestamp with time zone,
  tier_promotion_date date,
  tier_promotion_justification text,
  status character varying DEFAULT 'active'::character varying,
  superseded_by character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  reviewed_at timestamp with time zone,
  reviewed_by character varying,
  CONSTRAINT obj_tokens_pkey PRIMARY KEY (token_id)
);
CREATE TABLE public.parcel_corners (
  corner_id uuid NOT NULL DEFAULT gen_random_uuid(),
  parcel_id uuid,
  survey_point_id uuid,
  corner_number integer,
  corner_type character varying,
  monument_type character varying,
  monument_description text,
  bearing_to_next numeric,
  distance_to_next numeric,
  curve_data jsonb,
  notes text,
  CONSTRAINT parcel_corners_pkey PRIMARY KEY (corner_id),
  CONSTRAINT parcel_corners_parcel_id_fkey FOREIGN KEY (parcel_id) REFERENCES public.parcels(parcel_id),
  CONSTRAINT parcel_corners_survey_point_id_fkey FOREIGN KEY (survey_point_id) REFERENCES public.survey_points(point_id)
);
CREATE TABLE public.parcels (
  parcel_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  drawing_id uuid,
  parcel_number character varying UNIQUE,
  parcel_name character varying,
  owner_name character varying,
  owner_address text,
  legal_description text,
  area_sqft numeric,
  area_acres numeric,
  perimeter numeric,
  zoning character varying,
  land_use character varying,
  assessed_value numeric,
  boundary_geometry USER-DEFINED NOT NULL,
  notes text,
  attributes jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT parcels_pkey PRIMARY KEY (parcel_id),
  CONSTRAINT parcels_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT parcels_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id)
);
CREATE TABLE public.pavement_sections (
  section_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  alignment_id uuid,
  section_name character varying NOT NULL,
  section_code character varying,
  start_station numeric,
  end_station numeric,
  pavement_type character varying,
  design_life_years integer,
  traffic_index numeric,
  design_esal numeric,
  layer_structure jsonb,
  total_thickness_in numeric,
  subgrade_r_value integer,
  subgrade_cbr integer,
  design_notes text,
  spec_reference character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT pavement_sections_pkey PRIMARY KEY (section_id),
  CONSTRAINT pavement_sections_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT pavement_sections_alignment_id_fkey FOREIGN KEY (alignment_id) REFERENCES public.horizontal_alignments(alignment_id)
);
CREATE TABLE public.pipe_networks (
  network_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  name text,
  description text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT pipe_networks_pkey PRIMARY KEY (network_id),
  CONSTRAINT pipe_networks_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.pipes (
  pipe_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  network_id uuid,
  up_structure_id uuid,
  down_structure_id uuid,
  diameter_mm numeric,
  material text,
  slope numeric,
  length_m numeric,
  invert_up numeric,
  invert_dn numeric,
  status text DEFAULT 'draft'::text CHECK (status = ANY (ARRAY['draft'::text, 'design'::text, 'final'::text, 'proposed'::text])),
  geom USER-DEFINED,
  metadata jsonb,
  CONSTRAINT pipes_pkey PRIMARY KEY (pipe_id),
  CONSTRAINT pipes_network_id_fkey FOREIGN KEY (network_id) REFERENCES public.pipe_networks(network_id),
  CONSTRAINT pipes_up_structure_id_fkey FOREIGN KEY (up_structure_id) REFERENCES public.structures(structure_id),
  CONSTRAINT pipes_down_structure_id_fkey FOREIGN KEY (down_structure_id) REFERENCES public.structures(structure_id)
);
CREATE TABLE public.plot_style_standards (
  plot_style_id integer NOT NULL DEFAULT nextval('plot_style_standards_plot_style_id_seq'::regclass),
  style_name character varying NOT NULL,
  style_type character varying,
  color_id uuid,
  screen_color character varying,
  plot_color character varying,
  lineweight numeric,
  plot_lineweight numeric,
  linetype character varying,
  fill_style character varying,
  end_style character varying,
  join_style character varying,
  description text,
  usage_context text,
  file_reference character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT plot_style_standards_pkey PRIMARY KEY (plot_style_id),
  CONSTRAINT plot_style_standards_color_id_fkey FOREIGN KEY (color_id) REFERENCES public.color_standards(color_id)
);
CREATE TABLE public.point_description_codes (
  code_id integer NOT NULL DEFAULT nextval('point_description_codes_code_id_seq'::regclass),
  point_code character varying NOT NULL UNIQUE,
  description text NOT NULL,
  point_type character varying,
  category character varying,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT point_description_codes_pkey PRIMARY KEY (code_id)
);
CREATE TABLE public.profile_pvis (
  pvi_id uuid NOT NULL DEFAULT gen_random_uuid(),
  profile_id uuid,
  pvi_number integer NOT NULL,
  station numeric NOT NULL,
  elevation numeric,
  grade_in numeric,
  grade_out numeric,
  vertical_curve_length numeric,
  k_value numeric,
  high_low_point_station numeric,
  high_low_point_elevation numeric,
  notes text,
  CONSTRAINT profile_pvis_pkey PRIMARY KEY (pvi_id),
  CONSTRAINT profile_pvis_profile_id_fkey FOREIGN KEY (profile_id) REFERENCES public.vertical_profiles(profile_id)
);
CREATE TABLE public.profile_stations (
  station_id uuid NOT NULL DEFAULT gen_random_uuid(),
  profile_id uuid NOT NULL,
  alignment_id uuid NOT NULL,
  station numeric NOT NULL CHECK (station >= 0::numeric),
  station_formatted character varying,
  surface_elevation numeric,
  profile_elevation numeric NOT NULL,
  vertical_offset numeric,
  grade_ahead numeric,
  grade_behind numeric,
  in_vertical_curve boolean DEFAULT false,
  curve_id uuid,
  point_type character varying,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT profile_stations_pkey PRIMARY KEY (station_id),
  CONSTRAINT profile_stations_profile_id_fkey FOREIGN KEY (profile_id) REFERENCES public.vertical_profiles(profile_id),
  CONSTRAINT profile_stations_alignment_id_fkey FOREIGN KEY (alignment_id) REFERENCES public.horizontal_alignments(alignment_id),
  CONSTRAINT profile_stations_curve_id_fkey FOREIGN KEY (curve_id) REFERENCES public.profile_pvis(pvi_id)
);
CREATE TABLE public.project_details (
  detail_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid NOT NULL UNIQUE,
  street_address text,
  city text,
  state text DEFAULT 'CA'::text,
  zip_code text,
  county text,
  apn text,
  project_engineer text,
  project_manager text,
  design_lead text,
  client_contact_name text,
  client_contact_email text,
  client_contact_phone text,
  jurisdiction text,
  jurisdiction_type text CHECK (jurisdiction_type = ANY (ARRAY['City'::text, 'County'::text, 'Special District'::text, 'State'::text, 'Federal'::text])),
  permit_number text,
  project_type text CHECK (project_type = ANY (ARRAY['Residential'::text, 'Commercial'::text, 'Infrastructure'::text, 'Industrial'::text, 'Mixed-Use'::text, 'Institutional'::text])),
  project_phase text CHECK (project_phase = ANY (ARRAY['Planning'::text, 'Preliminary Design'::text, 'Design Development'::text, 'Construction Documents'::text, 'Bidding'::text, 'Construction'::text, 'As-Built'::text])),
  tb_format_type text,
  tb_format_size text DEFAULT '24x36'::text,
  design_start_date date,
  design_completion_date date,
  construction_start_date date,
  special_requirements text,
  notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT project_details_pkey PRIMARY KEY (detail_id),
  CONSTRAINT project_details_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.project_sheet_notes (
  project_note_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  set_id uuid,
  display_code text NOT NULL,
  standard_note_id integer,
  custom_title text,
  custom_text text,
  sort_order integer,
  is_modified boolean DEFAULT false,
  usage_count integer DEFAULT 0,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT project_sheet_notes_pkey PRIMARY KEY (project_note_id),
  CONSTRAINT project_sheet_notes_set_id_fkey FOREIGN KEY (set_id) REFERENCES public.sheet_note_sets(set_id),
  CONSTRAINT project_sheet_notes_standard_note_id_fkey FOREIGN KEY (standard_note_id) REFERENCES public.standard_notes(note_id)
);
CREATE TABLE public.project_tolerance_settings (
  project_id uuid NOT NULL,
  point_tolerance_ft numeric DEFAULT 0.01,
  line_tolerance_ft numeric DEFAULT 0.01,
  breakline_tolerance_ft numeric DEFAULT 0.001,
  alignment_tolerance_ft numeric DEFAULT 0.01,
  elevation_tolerance_ft numeric DEFAULT 0.01,
  dimension_tolerance_ft numeric DEFAULT 0.05,
  angle_tolerance_deg numeric DEFAULT 0.1,
  z_tolerance_ft numeric DEFAULT 0.01,
  coordinate_precision integer DEFAULT 2,
  elevation_precision integer DEFAULT 2,
  dimension_precision integer DEFAULT 2,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT project_tolerance_settings_pkey PRIMARY KEY (project_id),
  CONSTRAINT project_tolerance_settings_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.projects (
  project_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_name character varying NOT NULL,
  project_number character varying,
  client_name character varying,
  description text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  metadata jsonb,
  project_embedding USER-DEFINED,
  tags ARRAY,
  coordinate_system character varying,
  epsg_code integer,
  coordinate_system_name character varying,
  base_point_x double precision,
  base_point_y double precision,
  base_point_elevation double precision,
  vertical_datum character varying,
  coordinate_notes text,
  is_archived boolean DEFAULT false,
  archived_at timestamp with time zone,
  CONSTRAINT projects_pkey PRIMARY KEY (project_id)
);
CREATE TABLE public.property_mappings (
  mapping_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  scope character varying NOT NULL CHECK (scope::text = ANY (ARRAY['SYSTEM'::character varying, 'ORGANIZATION'::character varying, 'PROJECT'::character varying]::text[])),
  project_id uuid,
  organization_id uuid,
  cad_field_name character varying NOT NULL,
  cad_field_synonyms ARRAY,
  target_table character varying NOT NULL,
  target_field character varying NOT NULL,
  target_data_type character varying NOT NULL,
  requires_conversion boolean DEFAULT false,
  conversion_type character varying,
  conversion_params jsonb,
  source_units character varying,
  target_units character varying,
  conversion_factor numeric,
  vocabulary_type character varying,
  min_value numeric,
  max_value numeric,
  allowed_values ARRAY,
  regex_pattern character varying,
  priority integer DEFAULT 100,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  deleted_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  notes text,
  CONSTRAINT property_mappings_pkey PRIMARY KEY (mapping_id),
  CONSTRAINT property_mappings_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.right_of_way (
  row_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  drawing_id uuid,
  row_name character varying NOT NULL,
  row_type character varying,
  ownership character varying,
  jurisdiction character varying,
  dedication_info text,
  dedication_date date,
  width numeric,
  boundary_geometry USER-DEFINED NOT NULL,
  area_sqft numeric,
  notes text,
  attributes jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT right_of_way_pkey PRIMARY KEY (row_id),
  CONSTRAINT right_of_way_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT right_of_way_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id)
);
CREATE TABLE public.sheet_category_standards (
  category_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  category_code text NOT NULL UNIQUE,
  category_name text NOT NULL,
  default_hierarchy integer NOT NULL,
  discipline text CHECK (discipline = ANY (ARRAY['Civil'::text, 'Survey'::text, 'Landscape'::text, 'Structural'::text, 'All'::text])),
  description text,
  is_active boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT sheet_category_standards_pkey PRIMARY KEY (category_id)
);
CREATE TABLE public.sheet_drawing_assignments (
  assignment_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  sheet_id uuid UNIQUE,
  drawing_id uuid,
  layout_name text NOT NULL,
  assigned_date timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  assigned_by text,
  notes text,
  CONSTRAINT sheet_drawing_assignments_pkey PRIMARY KEY (assignment_id),
  CONSTRAINT sheet_drawing_assignments_sheet_id_fkey FOREIGN KEY (sheet_id) REFERENCES public.sheets(sheet_id),
  CONSTRAINT sheet_drawing_assignments_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id)
);
CREATE TABLE public.sheet_note_assignments (
  assignment_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  drawing_id uuid,
  layout_name text NOT NULL,
  project_note_id uuid,
  show_in_legend boolean DEFAULT true,
  legend_sequence integer,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT sheet_note_assignments_pkey PRIMARY KEY (assignment_id),
  CONSTRAINT sheet_note_assignments_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT sheet_note_assignments_project_note_id_fkey FOREIGN KEY (project_note_id) REFERENCES public.project_sheet_notes(project_note_id)
);
CREATE TABLE public.sheet_note_sets (
  set_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  set_name text NOT NULL,
  description text,
  discipline text,
  is_active boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT sheet_note_sets_pkey PRIMARY KEY (set_id),
  CONSTRAINT sheet_note_sets_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.sheet_notes (
  note_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  title text NOT NULL,
  category text,
  text text NOT NULL,
  tags ARRAY,
  is_standard boolean DEFAULT false,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT sheet_notes_pkey PRIMARY KEY (note_id),
  CONSTRAINT sheet_notes_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.sheet_relationships (
  relationship_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  from_sheet_id uuid,
  to_sheet_id uuid,
  relationship_type text CHECK (relationship_type = ANY (ARRAY['references'::text, 'detail_of'::text, 'continued_from'::text, 'see_also'::text])),
  notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT sheet_relationships_pkey PRIMARY KEY (relationship_id),
  CONSTRAINT sheet_relationships_from_sheet_id_fkey FOREIGN KEY (from_sheet_id) REFERENCES public.sheets(sheet_id),
  CONSTRAINT sheet_relationships_to_sheet_id_fkey FOREIGN KEY (to_sheet_id) REFERENCES public.sheets(sheet_id)
);
CREATE TABLE public.sheet_revisions (
  revision_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  sheet_id uuid,
  revision_number integer NOT NULL,
  revision_date date NOT NULL,
  description text,
  revised_by text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT sheet_revisions_pkey PRIMARY KEY (revision_id),
  CONSTRAINT sheet_revisions_sheet_id_fkey FOREIGN KEY (sheet_id) REFERENCES public.sheets(sheet_id)
);
CREATE TABLE public.sheet_sets (
  set_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  sheet_note_set_id uuid,
  set_name text NOT NULL,
  set_number text,
  phase text,
  discipline text CHECK (discipline = ANY (ARRAY['Civil'::text, 'Survey'::text, 'Landscape'::text, 'Mixed'::text, 'Structural'::text])),
  issue_date date,
  status text DEFAULT 'draft'::text CHECK (status = ANY (ARRAY['draft'::text, 'review'::text, 'submitted'::text, 'approved'::text, 'superseded'::text, 'archived'::text])),
  recipient text,
  transmittal_notes text,
  is_active boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT sheet_sets_pkey PRIMARY KEY (set_id),
  CONSTRAINT sheet_sets_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT sheet_sets_sheet_note_set_id_fkey FOREIGN KEY (sheet_note_set_id) REFERENCES public.sheet_note_sets(set_id)
);
CREATE TABLE public.sheet_templates (
  template_id integer NOT NULL DEFAULT nextval('sheet_templates_template_id_seq'::regclass),
  template_name character varying NOT NULL,
  sheet_size character varying,
  width_inches numeric,
  height_inches numeric,
  title_block_id uuid,
  discipline character varying,
  sheet_type character varying,
  border_style character varying,
  margin_left numeric,
  margin_right numeric,
  margin_top numeric,
  margin_bottom numeric,
  viewport_count integer,
  standard_scale character varying,
  description text,
  usage_context text,
  is_default boolean DEFAULT false,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT sheet_templates_pkey PRIMARY KEY (template_id),
  CONSTRAINT sheet_templates_title_block_id_fkey FOREIGN KEY (title_block_id) REFERENCES public.block_definitions(block_id)
);
CREATE TABLE public.sheets (
  sheet_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  set_id uuid,
  sheet_code text NOT NULL,
  sheet_number integer,
  sheet_title text NOT NULL,
  discipline_code text,
  sheet_type text,
  sheet_category text,
  sheet_hierarchy_number integer,
  scale text,
  sheet_size text DEFAULT '24x36'::text,
  template_id integer,
  revision_number integer DEFAULT 0,
  revision_date date,
  notes text,
  tags ARRAY,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT sheets_pkey PRIMARY KEY (sheet_id),
  CONSTRAINT sheets_set_id_fkey FOREIGN KEY (set_id) REFERENCES public.sheet_sets(set_id),
  CONSTRAINT sheets_sheet_category_fkey FOREIGN KEY (sheet_category) REFERENCES public.sheet_category_standards(category_code),
  CONSTRAINT sheets_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.sheet_templates(template_id)
);
CREATE TABLE public.site_trees (
  tree_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  survey_point_id uuid,
  drawing_id uuid,
  tree_number character varying,
  species character varying,
  common_name character varying,
  dbh_inches numeric,
  tree_height_ft numeric,
  canopy_spread_ft numeric,
  condition character varying,
  protection_status character varying,
  location_description text,
  planting_date date,
  notes text,
  attributes jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT site_trees_pkey PRIMARY KEY (tree_id),
  CONSTRAINT site_trees_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT site_trees_survey_point_id_fkey FOREIGN KEY (survey_point_id) REFERENCES public.survey_points(point_id),
  CONSTRAINT site_trees_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id)
);
CREATE TABLE public.standard_notes (
  note_id integer NOT NULL DEFAULT nextval('standard_notes_note_id_seq'::regclass),
  note_title character varying NOT NULL,
  note_text text NOT NULL,
  note_category character varying,
  discipline character varying,
  sheet_type character varying,
  code_reference_id integer,
  is_required boolean DEFAULT false,
  sort_order integer,
  tags ARRAY,
  usage_context text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT standard_notes_pkey PRIMARY KEY (note_id),
  CONSTRAINT standard_notes_code_reference_id_fkey FOREIGN KEY (code_reference_id) REFERENCES public.code_references(code_id)
);
CREATE TABLE public.structures (
  structure_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  network_id uuid,
  type text CHECK (type = ANY (ARRAY['manhole'::text, 'inlet'::text, 'outlet'::text, 'junction'::text])),
  rim_elev numeric,
  sump_depth numeric,
  geom USER-DEFINED,
  metadata jsonb,
  invert_elev numeric,
  CONSTRAINT structures_pkey PRIMARY KEY (structure_id),
  CONSTRAINT structures_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT structures_network_id_fkey FOREIGN KEY (network_id) REFERENCES public.pipe_networks(network_id)
);
CREATE TABLE public.surface_breaklines (
  breakline_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid NOT NULL,
  drawing_id uuid,
  surface_id uuid,
  breakline_name character varying,
  breakline_number character varying,
  breakline_type character varying NOT NULL,
  breakline_subtype character varying,
  geometry USER-DEFINED NOT NULL,
  length_ft numeric CHECK (length_ft > 0.1),
  vertex_count integer CHECK (vertex_count >= 2),
  z_min numeric,
  z_max numeric,
  z_range numeric,
  z_monotonic boolean,
  z_direction character varying CHECK (z_direction::text = ANY (ARRAY['INCREASING'::character varying, 'DECREASING'::character varying, 'VARIABLE'::character varying, 'FLAT'::character varying]::text[])),
  proximity_type character varying DEFAULT 'STANDARD'::character varying CHECK (proximity_type::text = ANY (ARRAY['STANDARD'::character varying, 'HARD'::character varying, 'SOFT'::character varying]::text[])),
  weighting numeric DEFAULT 1.0,
  is_one_sided boolean DEFAULT false,
  is_hidden boolean DEFAULT false,
  is_closed boolean,
  is_self_intersecting boolean DEFAULT false,
  start_point_id uuid,
  end_point_id uuid,
  surface_assignment character varying DEFAULT 'BOTH'::character varying,
  validation_status character varying DEFAULT 'PENDING'::character varying,
  validation_errors jsonb DEFAULT '[]'::jsonb,
  validation_warnings jsonb DEFAULT '[]'::jsonb,
  has_non_3d_vertices boolean DEFAULT false,
  has_z_spikes boolean DEFAULT false,
  has_self_intersection boolean DEFAULT false,
  last_validated_at timestamp with time zone,
  created_by character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  notes text,
  attributes jsonb,
  CONSTRAINT surface_breaklines_pkey PRIMARY KEY (breakline_id),
  CONSTRAINT surface_breaklines_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT surface_breaklines_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT surface_breaklines_surface_id_fkey FOREIGN KEY (surface_id) REFERENCES public.surface_models(surface_id),
  CONSTRAINT surface_breaklines_start_point_id_fkey FOREIGN KEY (start_point_id) REFERENCES public.survey_points(point_id),
  CONSTRAINT surface_breaklines_end_point_id_fkey FOREIGN KEY (end_point_id) REFERENCES public.survey_points(point_id)
);
CREATE TABLE public.surface_features (
  feature_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  survey_point_id uuid,
  drawing_id uuid,
  feature_type character varying,
  geometry USER-DEFINED NOT NULL,
  material character varying,
  dimensions jsonb,
  description text,
  notes text,
  attributes jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT surface_features_pkey PRIMARY KEY (feature_id),
  CONSTRAINT surface_features_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT surface_features_survey_point_id_fkey FOREIGN KEY (survey_point_id) REFERENCES public.survey_points(point_id),
  CONSTRAINT surface_features_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id)
);
CREATE TABLE public.surface_models (
  surface_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  drawing_id uuid,
  surface_name character varying NOT NULL,
  surface_type character varying,
  description text,
  creation_date date,
  created_by character varying,
  point_count integer,
  triangle_count integer,
  min_elevation numeric,
  max_elevation numeric,
  bounding_box USER-DEFINED,
  surface_file_path character varying,
  surface_format character varying,
  notes text,
  attributes jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT surface_models_pkey PRIMARY KEY (surface_id),
  CONSTRAINT surface_models_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT surface_models_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id)
);
CREATE TABLE public.survey_control_network (
  network_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  network_name character varying NOT NULL,
  network_type character varying,
  network_order character varying,
  description text,
  adjustment_method character varying,
  adjustment_date date,
  adjustment_software character varying,
  standard_error_h numeric,
  standard_error_v numeric,
  confidence_level numeric,
  is_active boolean DEFAULT true,
  notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT survey_control_network_pkey PRIMARY KEY (network_id),
  CONSTRAINT survey_control_network_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.survey_observations (
  observation_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  drawing_id uuid,
  session_id character varying,
  observation_type character varying NOT NULL,
  observation_date date,
  observation_time time without time zone,
  instrument_station_point_id uuid,
  backsight_point_id uuid,
  target_point_id uuid,
  horizontal_angle numeric,
  vertical_angle numeric,
  slope_distance numeric,
  horizontal_distance numeric,
  vertical_distance numeric,
  instrument_height numeric,
  target_height numeric,
  temperature_f numeric,
  pressure_inhg numeric,
  ppm_correction numeric,
  standard_deviation numeric,
  rejected boolean DEFAULT false,
  raw_data jsonb,
  notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT survey_observations_pkey PRIMARY KEY (observation_id),
  CONSTRAINT survey_observations_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT survey_observations_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT survey_observations_instrument_station_point_id_fkey FOREIGN KEY (instrument_station_point_id) REFERENCES public.survey_points(point_id),
  CONSTRAINT survey_observations_backsight_point_id_fkey FOREIGN KEY (backsight_point_id) REFERENCES public.survey_points(point_id),
  CONSTRAINT survey_observations_target_point_id_fkey FOREIGN KEY (target_point_id) REFERENCES public.survey_points(point_id)
);
CREATE TABLE public.survey_points (
  point_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  drawing_id uuid,
  point_number character varying NOT NULL,
  point_description text,
  point_code character varying,
  point_type character varying,
  geometry USER-DEFINED NOT NULL,
  northing numeric,
  easting numeric,
  elevation numeric,
  coordinate_system character varying,
  epsg_code character varying,
  survey_date date,
  surveyed_by character varying,
  survey_method character varying,
  instrument_used character varying,
  horizontal_accuracy numeric,
  vertical_accuracy numeric,
  accuracy_units character varying DEFAULT 'Feet'::character varying,
  quality_code character varying,
  is_control_point boolean DEFAULT false,
  is_active boolean DEFAULT true,
  superseded_by uuid,
  notes text,
  attributes jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  z_required boolean DEFAULT false,
  z_validation_context character varying,
  point_number_source character varying DEFAULT 'FIELD_CREW'::character varying,
  point_number_sequence integer,
  description_required boolean DEFAULT false,
  description_vocab character varying,
  accuracy_class character varying DEFAULT 'STANDARD'::character varying,
  accuracy_h_required numeric,
  accuracy_v_required numeric,
  accuracy_h_achieved numeric,
  accuracy_v_achieved numeric,
  accuracy_status character varying,
  validation_status character varying DEFAULT 'PENDING'::character varying,
  validation_errors jsonb DEFAULT '[]'::jsonb,
  validation_warnings jsonb DEFAULT '[]'::jsonb,
  last_validated_at timestamp with time zone,
  CONSTRAINT survey_points_pkey PRIMARY KEY (point_id),
  CONSTRAINT survey_points_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT survey_points_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT survey_points_superseded_by_fkey FOREIGN KEY (superseded_by) REFERENCES public.survey_points(point_id)
);
CREATE TABLE public.symbol_categories (
  category_id integer NOT NULL DEFAULT nextval('symbol_categories_category_id_seq'::regclass),
  category_name character varying NOT NULL,
  parent_category_id integer,
  discipline character varying,
  sort_order integer,
  icon_name character varying,
  description text,
  usage_context text,
  is_active boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT symbol_categories_pkey PRIMARY KEY (category_id),
  CONSTRAINT symbol_categories_parent_category_id_fkey FOREIGN KEY (parent_category_id) REFERENCES public.symbol_categories(category_id)
);
CREATE TABLE public.symbol_formats (
  format_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  block_id uuid,
  format_type character varying NOT NULL,
  content text NOT NULL,
  is_primary boolean DEFAULT false,
  generated_from character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  metadata jsonb,
  CONSTRAINT symbol_formats_pkey PRIMARY KEY (format_id),
  CONSTRAINT symbol_formats_block_id_fkey FOREIGN KEY (block_id) REFERENCES public.block_definitions(block_id)
);
CREATE TABLE public.tags (
  tag_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  tag_name character varying NOT NULL UNIQUE,
  tag_category character varying,
  description text,
  CONSTRAINT tags_pkey PRIMARY KEY (tag_id)
);
CREATE TABLE public.text_styles (
  style_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  style_name character varying NOT NULL UNIQUE,
  font_name character varying NOT NULL,
  font_file character varying,
  height double precision DEFAULT 0,
  width_factor double precision DEFAULT 1.0,
  oblique_angle double precision DEFAULT 0,
  is_backward boolean DEFAULT false,
  is_upside_down boolean DEFAULT false,
  is_vertical boolean DEFAULT false,
  usage_context text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT text_styles_pkey PRIMARY KEY (style_id)
);
CREATE TABLE public.tier_promotion_requests (
  request_id uuid NOT NULL DEFAULT gen_random_uuid(),
  promotion_type character varying NOT NULL,
  proposed_token character varying,
  proposed_subtype_code character varying,
  parent_token character varying,
  meets_cad_behavior_rule boolean DEFAULT false,
  cad_behavior_evidence text,
  meets_routing_rule boolean DEFAULT false,
  routing_evidence text,
  meets_recognition_rule boolean DEFAULT false,
  recognition_evidence text,
  meets_enumerable_rule boolean DEFAULT false,
  usage_count_evidence integer,
  project_examples ARRAY,
  standard_references ARRAY,
  submitted_by character varying NOT NULL,
  submitted_at timestamp with time zone DEFAULT now(),
  submitter_rationale text NOT NULL,
  status character varying DEFAULT 'pending'::character varying,
  reviewed_by character varying,
  reviewed_at timestamp with time zone,
  review_notes text,
  decision character varying,
  decision_rationale text,
  merge_with_existing_id uuid,
  implemented_at timestamp with time zone,
  created_token_id uuid,
  created_subtype_id uuid,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT tier_promotion_requests_pkey PRIMARY KEY (request_id)
);
CREATE TABLE public.traverse_loop_observations (
  loop_observation_id uuid NOT NULL DEFAULT gen_random_uuid(),
  loop_id uuid,
  observation_id uuid,
  sequence_order integer NOT NULL,
  point_id uuid,
  bearing_from_prev numeric,
  distance_from_prev numeric,
  adjusted_bearing numeric,
  adjusted_distance numeric,
  notes text,
  CONSTRAINT traverse_loop_observations_pkey PRIMARY KEY (loop_observation_id),
  CONSTRAINT traverse_loop_observations_loop_id_fkey FOREIGN KEY (loop_id) REFERENCES public.traverse_loops(loop_id),
  CONSTRAINT traverse_loop_observations_observation_id_fkey FOREIGN KEY (observation_id) REFERENCES public.survey_observations(observation_id),
  CONSTRAINT traverse_loop_observations_point_id_fkey FOREIGN KEY (point_id) REFERENCES public.survey_points(point_id)
);
CREATE TABLE public.traverse_loops (
  loop_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  loop_name character varying NOT NULL,
  description text,
  loop_type character varying,
  adjustment_method character varying,
  adjustment_date date,
  angular_misclosure numeric,
  linear_misclosure numeric,
  closure_ratio character varying,
  closure_error_h numeric,
  closure_error_v numeric,
  adjustment_notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT traverse_loops_pkey PRIMARY KEY (loop_id),
  CONSTRAINT traverse_loops_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.typical_sections (
  typical_section_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  section_name character varying NOT NULL,
  section_code character varying,
  road_classification character varying,
  total_width numeric,
  lane_count integer,
  lane_width numeric,
  shoulder_width_left numeric,
  shoulder_width_right numeric,
  median_width numeric,
  curb_height numeric,
  curb_type character varying,
  crown_slope numeric,
  superelevation_max numeric,
  cut_slope_ratio character varying,
  fill_slope_ratio character varying,
  sidewalk_width numeric,
  bike_lane_width numeric,
  section_geometry jsonb,
  pavement_section_id uuid,
  description text,
  notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT typical_sections_pkey PRIMARY KEY (typical_section_id),
  CONSTRAINT typical_sections_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT typical_sections_pavement_section_id_fkey FOREIGN KEY (pavement_section_id) REFERENCES public.pavement_sections(section_id)
);
CREATE TABLE public.utilities (
  utility_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  project_id uuid,
  company text,
  type text CHECK (type = ANY (ARRAY['electric'::text, 'gas'::text, 'water'::text, 'sewer'::text, 'telecom'::text])),
  status text DEFAULT 'pending'::text CHECK (status = ANY (ARRAY['pending'::text, 'response_received'::text, 'closed'::text])),
  request_date date,
  response_date date,
  contact text,
  metadata jsonb,
  CONSTRAINT utilities_pkey PRIMARY KEY (utility_id),
  CONSTRAINT utilities_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id)
);
CREATE TABLE public.utility_lines (
  line_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  drawing_id uuid,
  line_number character varying,
  utility_system character varying NOT NULL,
  line_type character varying,
  material character varying,
  diameter_mm integer,
  invert_elevation_start numeric,
  invert_elevation_end numeric,
  slope numeric,
  length numeric,
  flow_direction character varying,
  design_flow numeric,
  capacity numeric,
  pressure_psi numeric,
  from_structure_id uuid,
  to_structure_id uuid,
  geometry USER-DEFINED NOT NULL,
  owner character varying,
  install_date date,
  condition character varying,
  notes text,
  attributes jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT utility_lines_pkey PRIMARY KEY (line_id),
  CONSTRAINT utility_lines_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT utility_lines_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id),
  CONSTRAINT utility_lines_from_structure_id_fkey FOREIGN KEY (from_structure_id) REFERENCES public.utility_structures(structure_id),
  CONSTRAINT utility_lines_to_structure_id_fkey FOREIGN KEY (to_structure_id) REFERENCES public.utility_structures(structure_id)
);
CREATE TABLE public.utility_network_connectivity (
  connection_id uuid NOT NULL DEFAULT gen_random_uuid(),
  from_element_id uuid NOT NULL,
  from_element_type character varying NOT NULL,
  to_element_id uuid NOT NULL,
  to_element_type character varying NOT NULL,
  connection_type character varying,
  flow_direction character varying,
  notes text,
  CONSTRAINT utility_network_connectivity_pkey PRIMARY KEY (connection_id)
);
CREATE TABLE public.utility_service_connections (
  service_id uuid NOT NULL DEFAULT gen_random_uuid(),
  line_id uuid,
  structure_id uuid,
  service_point_geometry USER-DEFINED,
  service_type character varying,
  service_address character varying,
  size_mm integer,
  material character varying,
  customer_account character varying,
  install_date date,
  notes text,
  attributes jsonb,
  CONSTRAINT utility_service_connections_pkey PRIMARY KEY (service_id),
  CONSTRAINT utility_service_connections_line_id_fkey FOREIGN KEY (line_id) REFERENCES public.utility_lines(line_id),
  CONSTRAINT utility_service_connections_structure_id_fkey FOREIGN KEY (structure_id) REFERENCES public.utility_structures(structure_id)
);
CREATE TABLE public.utility_structures (
  structure_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  survey_point_id uuid,
  drawing_id uuid,
  structure_number character varying,
  structure_type character varying,
  utility_system character varying,
  rim_elevation numeric,
  invert_elevation numeric,
  rim_geometry USER-DEFINED,
  size_mm integer,
  material character varying,
  manhole_depth_ft numeric,
  condition character varying,
  owner character varying,
  install_date date,
  notes text,
  attributes jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT utility_structures_pkey PRIMARY KEY (structure_id),
  CONSTRAINT utility_structures_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT utility_structures_survey_point_id_fkey FOREIGN KEY (survey_point_id) REFERENCES public.survey_points(point_id),
  CONSTRAINT utility_structures_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id)
);
CREATE TABLE public.validation_error_catalog (
  error_code character varying NOT NULL,
  error_category character varying NOT NULL,
  severity character varying NOT NULL CHECK (severity::text = ANY (ARRAY['ERROR'::character varying, 'WARNING'::character varying, 'INFO'::character varying]::text[])),
  error_title character varying NOT NULL,
  error_description text NOT NULL,
  typical_causes ARRAY,
  recommended_actions ARRAY,
  can_auto_fix boolean DEFAULT false,
  auto_fix_function character varying,
  documentation_url text,
  related_codes ARRAY,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT validation_error_catalog_pkey PRIMARY KEY (error_code)
);
CREATE TABLE public.validation_log (
  log_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  drawing_id uuid,
  import_job_id uuid,
  object_type character varying NOT NULL,
  object_id uuid,
  entity_id uuid,
  validation_type character varying NOT NULL,
  validator_name character varying NOT NULL,
  status character varying NOT NULL CHECK (status::text = ANY (ARRAY['PASS'::character varying, 'WARN'::character varying, 'ERROR'::character varying, 'INFO'::character varying]::text[])),
  error_code character varying,
  message text NOT NULL,
  details jsonb,
  resolution_action character varying,
  resolution_notes text,
  resolved_at timestamp with time zone,
  resolved_by character varying,
  created_at timestamp with time zone DEFAULT now(),
  duration_ms integer,
  CONSTRAINT validation_log_pkey PRIMARY KEY (log_id),
  CONSTRAINT validation_log_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT validation_log_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id)
);
CREATE TABLE public.validation_sessions (
  session_id uuid NOT NULL DEFAULT gen_random_uuid(),
  project_id uuid,
  drawing_id uuid,
  import_job_id uuid,
  session_type character varying NOT NULL,
  validator_config jsonb,
  started_at timestamp with time zone NOT NULL DEFAULT now(),
  completed_at timestamp with time zone,
  duration_ms integer,
  total_objects integer DEFAULT 0,
  passed integer DEFAULT 0,
  warnings integer DEFAULT 0,
  errors integer DEFAULT 0,
  session_status character varying DEFAULT 'RUNNING'::character varying,
  triggered_by character varying,
  notes text,
  CONSTRAINT validation_sessions_pkey PRIMARY KEY (session_id),
  CONSTRAINT validation_sessions_project_id_fkey FOREIGN KEY (project_id) REFERENCES public.projects(project_id),
  CONSTRAINT validation_sessions_drawing_id_fkey FOREIGN KEY (drawing_id) REFERENCES public.drawings(drawing_id)
);
CREATE TABLE public.vertical_elements (
  element_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  alignment_id uuid,
  type text CHECK (type = ANY (ARRAY['grade'::text, 'vc_crest'::text, 'vc_sag'::text])),
  params jsonb,
  start_station numeric,
  end_station numeric,
  CONSTRAINT vertical_elements_pkey PRIMARY KEY (element_id),
  CONSTRAINT vertical_elements_alignment_id_fkey FOREIGN KEY (alignment_id) REFERENCES public.alignments(alignment_id)
);
CREATE TABLE public.vertical_profiles (
  profile_id uuid NOT NULL DEFAULT gen_random_uuid(),
  alignment_id uuid,
  profile_name character varying NOT NULL,
  description text,
  profile_type character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  profile_geometry jsonb,
  profile_length numeric,
  min_grade numeric,
  max_grade numeric,
  k_value_min numeric,
  validation_status character varying DEFAULT 'PENDING'::character varying,
  validation_errors jsonb DEFAULT '[]'::jsonb,
  validation_warnings jsonb DEFAULT '[]'::jsonb,
  last_validated_at timestamp with time zone,
  profile_status character varying DEFAULT 'DRAFT'::character varying,
  is_design_profile boolean DEFAULT false,
  CONSTRAINT vertical_profiles_pkey PRIMARY KEY (profile_id),
  CONSTRAINT vertical_profiles_alignment_id_fkey FOREIGN KEY (alignment_id) REFERENCES public.horizontal_alignments(alignment_id)
);
CREATE TABLE public.viewport_standards (
  viewport_id integer NOT NULL DEFAULT nextval('viewport_standards_viewport_id_seq'::regclass),
  viewport_name character varying NOT NULL,
  scale_text character varying,
  scale_factor numeric,
  discipline character varying,
  view_type character varying,
  typical_width numeric,
  typical_height numeric,
  annotation_scale character varying,
  layer_overrides ARRAY,
  description text,
  usage_context text,
  is_standard boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT viewport_standards_pkey PRIMARY KEY (viewport_id)
);
CREATE TABLE public.vocabulary_mappings (
  vocab_id uuid NOT NULL DEFAULT uuid_generate_v4(),
  vocabulary_type character varying NOT NULL,
  input_term character varying NOT NULL,
  canonical_term character varying NOT NULL,
  display_term character varying,
  applicable_tables ARRAY,
  discipline character varying,
  confidence integer DEFAULT 100 CHECK (confidence >= 0 AND confidence <= 100),
  conflicts_with ARRAY,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp with time zone DEFAULT CURRENT_TIMESTAMP,
  deleted_at timestamp with time zone,
  metadata jsonb DEFAULT '{}'::jsonb,
  notes text,
  CONSTRAINT vocabulary_mappings_pkey PRIMARY KEY (vocab_id)
);