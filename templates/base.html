<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Schema Explorer{% endblock %} - ACAD-GIS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="grid-background">
    <header class="header">
        <div class="header-content">
            <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Toggle sidebar">
                <i class="fas fa-bars"></i>
            </button>
            <div class="header-title">
                <i class="fas fa-database neon-blue"></i>
                <div>
                    <h1 class="orbitron">ACAD-GIS Schema Explorer</h1>
                    <div class="header-subtitle">Database Management & Viewer</div>
                </div>
            </div>
        </div>
    </header>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-content">
            <div class="sidebar-section">
                <a href="/" class="sidebar-link {% if request.path == '/' %}active{% endif %}">
                    <i class="fas fa-home"></i>
                    <span class="sidebar-text">Home</span>
                </a>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">
                    <i class="fas fa-database"></i>
                    <span class="sidebar-text">Database</span>
                </div>
                <a href="/schema" class="sidebar-link {% if request.path == '/schema' %}active{% endif %}">
                    <i class="fas fa-table"></i>
                    <span class="sidebar-text">Schema</span>
                </a>
                <a href="/schema/relationships" class="sidebar-link {% if request.path == '/schema/relationships' %}active{% endif %}">
                    <i class="fas fa-project-diagram"></i>
                    <span class="sidebar-text">Relationships</span>
                </a>
                <a href="/data-manager" class="sidebar-link {% if request.path.startswith('/data-manager') %}active{% endif %}">
                    <i class="fas fa-edit"></i>
                    <span class="sidebar-text">Data Manager</span>
                </a>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">
                    <i class="fas fa-robot"></i>
                    <span class="sidebar-text">AI Tools</span>
                </div>
                <a href="/toolkit" class="sidebar-link {% if request.path == '/toolkit' %}active{% endif %}">
                    <i class="fas fa-tools"></i>
                    <span class="sidebar-text">AI Toolkit</span>
                </a>
                <a href="/graph" class="sidebar-link {% if request.path == '/graph' %}active{% endif %}">
                    <i class="fas fa-network-wired"></i>
                    <span class="sidebar-text">Knowledge Graph</span>
                </a>
                <a href="/quality-dashboard" class="sidebar-link {% if request.path == '/quality-dashboard' %}active{% endif %}">
                    <i class="fas fa-chart-line"></i>
                    <span class="sidebar-text">Quality Dashboard</span>
                </a>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">
                    <i class="fas fa-drafting-compass"></i>
                    <span class="sidebar-text">CAD Tools</span>
                </div>
                <a href="/dxf-tools" class="sidebar-link {% if request.path == '/dxf-tools' %}active{% endif %}">
                    <i class="fas fa-file-export"></i>
                    <span class="sidebar-text">DXF Tools</span>
                </a>
                <a href="/map-viewer-v2" class="sidebar-link {% if request.path in ['/map-viewer', '/map-viewer-v2'] %}active{% endif %}">
                    <i class="fas fa-map-marked-alt"></i>
                    <span class="sidebar-text">Map Viewer</span>
                </a>
                <a href="/gravity-network-editor" class="sidebar-link {% if request.path == '/gravity-network-editor' %}active{% endif %}">
                    <i class="fas fa-water"></i>
                    <span class="sidebar-text">Gravity Network Editor</span>
                </a>
                <a href="/sheet-notes" class="sidebar-link {% if request.path == '/sheet-notes' %}active{% endif %}">
                    <i class="fas fa-sticky-note"></i>
                    <span class="sidebar-text">Sheet Notes</span>
                </a>
                <a href="/sheet-sets" class="sidebar-link {% if request.path == '/sheet-sets' %}active{% endif %}">
                    <i class="fas fa-folder-open"></i>
                    <span class="sidebar-text">Sheet Sets</span>
                </a>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">
                    <i class="fas fa-ruler-combined"></i>
                    <span class="sidebar-text">Standards</span>
                </div>
                <a href="/standards" class="sidebar-link {% if request.path == '/standards' %}active{% endif %}">
                    <i class="fas fa-book"></i>
                    <span class="sidebar-text">CAD Standards</span>
                </a>
                <a href="/standards/reference" class="sidebar-link {% if request.path == '/standards/reference' %}active{% endif %}">
                    <i class="fas fa-layer-group"></i>
                    <span class="sidebar-text">Layer Reference</span>
                </a>
                <a href="/standards/vocabulary" class="sidebar-link {% if request.path == '/standards/vocabulary' %}active{% endif %}">
                    <i class="fas fa-book-open"></i>
                    <span class="sidebar-text">Vocabulary</span>
                </a>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">
                    <i class="fas fa-folder"></i>
                    <span class="sidebar-text">Projects</span>
                </div>
                <a href="/projects" class="sidebar-link {% if request.path == '/projects' %}active{% endif %}">
                    <i class="fas fa-briefcase"></i>
                    <span class="sidebar-text">Projects</span>
                </a>
                <a href="/drawings" class="sidebar-link {% if request.path == '/drawings' %}active{% endif %}">
                    <i class="fas fa-file-image"></i>
                    <span class="sidebar-text">Drawings</span>
                </a>
            </div>

            <div class="sidebar-section">
                <div class="sidebar-section-title">
                    <i class="fas fa-info-circle"></i>
                    <span class="sidebar-text">Information</span>
                </div>
                <a href="/why-this-matters" class="sidebar-link {% if request.path == '/why-this-matters' %}active{% endif %}">
                    <i class="fas fa-lightbulb"></i>
                    <span class="sidebar-text">Why This Matters</span>
                </a>
                <a href="/architecture" class="sidebar-link {% if request.path == '/architecture' %}active{% endif %}">
                    <i class="fas fa-sitemap"></i>
                    <span class="sidebar-text">Architecture</span>
                </a>
            </div>
        </div>
    </aside>

    <main class="main-content" id="mainContent">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>

    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('sidebar-collapsed');
            
            localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
        }

        function updateHeaderHeight() {
            const header = document.querySelector('.header');
            const headerHeight = header ? header.offsetHeight : 100;
            document.documentElement.style.setProperty('--header-height', `${headerHeight}px`);
        }

        document.addEventListener('DOMContentLoaded', function() {
            const isCollapsed = localStorage.getItem('sidebarCollapsed');
            const isMobile = window.innerWidth <= 768;
            
            if (isCollapsed === 'true' || (isCollapsed === null && isMobile)) {
                document.getElementById('sidebar').classList.add('collapsed');
                document.getElementById('mainContent').classList.add('sidebar-collapsed');
            }
            
            updateHeaderHeight();
            
            let resizeTimeout;
            window.addEventListener('resize', function() {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(updateHeaderHeight, 100);
            });
        });

        async function checkHealth() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                return data.status === 'connected';
            } catch {
                return false;
            }
        }

        async function deleteItem(endpoint, id, itemName) {
            if (!confirm(`Are you sure you want to delete ${itemName}?`)) {
                return;
            }

            try {
                const response = await fetch(`${endpoint}/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    location.reload();
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.error || 'Failed to delete'}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>
