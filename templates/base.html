<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Schema Explorer{% endblock %} - ACAD-GIS</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    {% block extra_head %}{% endblock %}
</head>
<body class="grid-background">
    <div class="sticky-header-container">
        <header class="header">
            <div class="header-content">
                <div class="header-title">
                    <i class="fas fa-database neon-blue"></i>
                    <div>
                        <h1 class="orbitron">ACAD-GIS Schema Explorer</h1>
                        <div class="header-subtitle">Database Management & Viewer</div>
                    </div>
                </div>
            </div>
        </header>

        <nav class="mc-navbar" id="navbar">
        <button class="mc-navbar-mobile-toggle" id="mobileToggle" aria-label="Toggle navigation" aria-expanded="false">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="mc-navbar-menu" id="navbarMenu">
            <a href="/" class="mc-nav-item {% if request.path == '/' %}active{% endif %}">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>

            <div class="mc-nav-item mc-has-dropdown {% if request.path in ['/standards-library', '/standards/layer-vocabulary', '/standards/reference-data', '/standards/reference'] %}active{% endif %}">
                <button class="mc-nav-link" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-ruler-combined"></i>
                    <span>Standards</span>
                    <i class="fas fa-chevron-down mc-dropdown-icon"></i>
                </button>
                <div class="mc-dropdown">
                    <a href="/standards-library" class="mc-dropdown-item {% if request.path == '/standards-library' %}active{% endif %}">
                        <i class="fas fa-th-large"></i>
                        CAD Standards Portal
                    </a>
                    <a href="/standards/layer-vocabulary" class="mc-dropdown-item {% if request.path == '/standards/layer-vocabulary' %}active{% endif %}">
                        <i class="fas fa-layer-group"></i>
                        Layer Vocabulary
                    </a>
                    <a href="/standards/reference-data" class="mc-dropdown-item {% if request.path == '/standards/reference-data' %}active{% endif %}">
                        <i class="fas fa-database"></i>
                        Reference Data Hub
                    </a>
                    <a href="/standards/reference" class="mc-dropdown-item {% if request.path == '/standards/reference' %}active{% endif %}">
                        <i class="fas fa-book-open"></i>
                        Layer Standards Reference
                    </a>
                </div>
            </div>

            <div class="mc-nav-item mc-has-dropdown {% if (request.path == '/data-manager' or request.path.startswith('/data-manager/')) and request.path not in ['/data-manager/drawings', '/data-manager/sheet-sets', '/data-manager/block-mappings', '/data-manager/detail-mappings', '/data-manager/hatch-mappings', '/data-manager/material-mappings', '/data-manager/note-mappings'] %}active{% endif %}">
                <button class="mc-nav-link" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-edit"></i>
                    <span>Data Manager</span>
                    <i class="fas fa-chevron-down mc-dropdown-icon"></i>
                </button>
                <div class="mc-dropdown">
                    <a href="/data-manager/layers" class="mc-dropdown-item {% if request.path == '/data-manager/layers' %}active{% endif %}">
                        <i class="fas fa-layer-group"></i>
                        Layers
                    </a>
                    <a href="/data-manager/blocks" class="mc-dropdown-item {% if request.path == '/data-manager/blocks' %}active{% endif %}">
                        <i class="fas fa-cube"></i>
                        Blocks
                    </a>
                    <a href="/data-manager/hatches" class="mc-dropdown-item {% if request.path == '/data-manager/hatches' %}active{% endif %}">
                        <i class="fas fa-grip-lines"></i>
                        Hatches
                    </a>
                    <a href="/data-manager/linetypes" class="mc-dropdown-item {% if request.path == '/data-manager/linetypes' %}active{% endif %}">
                        <i class="fas fa-minus"></i>
                        Linetypes
                    </a>
                    <a href="/data-manager/text-styles" class="mc-dropdown-item {% if request.path == '/data-manager/text-styles' %}active{% endif %}">
                        <i class="fas fa-font"></i>
                        Text Styles
                    </a>
                    <a href="/data-manager/dimension-styles" class="mc-dropdown-item {% if request.path == '/data-manager/dimension-styles' %}active{% endif %}">
                        <i class="fas fa-ruler-combined"></i>
                        Dimension Styles
                    </a>
                    <a href="/data-manager/materials" class="mc-dropdown-item {% if request.path == '/data-manager/materials' %}active{% endif %}">
                        <i class="fas fa-tools"></i>
                        Materials
                    </a>
                    <a href="/data-manager/details" class="mc-dropdown-item {% if request.path == '/data-manager/details' %}active{% endif %}">
                        <i class="fas fa-file-alt"></i>
                        Details
                    </a>
                    <a href="/data-manager/standard-notes" class="mc-dropdown-item {% if request.path == '/data-manager/standard-notes' %}active{% endif %}">
                        <i class="fas fa-sticky-note"></i>
                        Standard Notes
                    </a>
                    <a href="/data-manager/abbreviations" class="mc-dropdown-item {% if request.path == '/data-manager/abbreviations' %}active{% endif %}">
                        <i class="fas fa-font"></i>
                        Abbreviations
                    </a>
                </div>
            </div>

            <div class="mc-nav-item mc-has-dropdown {% if request.path in ['/standards-mapping-dashboard', '/project-context-manager', '/data-manager/block-mappings', '/data-manager/detail-mappings', '/data-manager/hatch-mappings', '/data-manager/material-mappings', '/data-manager/note-mappings', '/standards-export'] %}active{% endif %}">
                <button class="mc-nav-link" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-map-signs"></i>
                    <span>Mapping</span>
                    <i class="fas fa-chevron-down mc-dropdown-icon"></i>
                </button>
                <div class="mc-dropdown">
                    <a href="/standards-mapping-dashboard" class="mc-dropdown-item {% if request.path == '/standards-mapping-dashboard' %}active{% endif %}">
                        <i class="fas fa-th-large"></i>
                        Mapping Dashboard
                    </a>
                    <a href="/project-context-manager" class="mc-dropdown-item {% if request.path == '/project-context-manager' %}active{% endif %}">
                        <i class="fas fa-project-diagram"></i>
                        Project Context Manager
                    </a>
                    <div class="mc-dropdown-divider"></div>
                    <a href="/data-manager/block-mappings" class="mc-dropdown-item {% if request.path == '/data-manager/block-mappings' %}active{% endif %}">
                        <i class="fas fa-cube"></i>
                        Block Name Mappings
                    </a>
                    <a href="/data-manager/detail-mappings" class="mc-dropdown-item {% if request.path == '/data-manager/detail-mappings' %}active{% endif %}">
                        <i class="fas fa-file-alt"></i>
                        Detail Name Mappings
                    </a>
                    <a href="/data-manager/hatch-mappings" class="mc-dropdown-item {% if request.path == '/data-manager/hatch-mappings' %}active{% endif %}">
                        <i class="fas fa-fill-drip"></i>
                        Hatch Name Mappings
                    </a>
                    <a href="/data-manager/material-mappings" class="mc-dropdown-item {% if request.path == '/data-manager/material-mappings' %}active{% endif %}">
                        <i class="fas fa-tools"></i>
                        Material Name Mappings
                    </a>
                    <a href="/data-manager/note-mappings" class="mc-dropdown-item {% if request.path == '/data-manager/note-mappings' %}active{% endif %}">
                        <i class="fas fa-sticky-note"></i>
                        Note Name Mappings
                    </a>
                    <div class="mc-dropdown-divider"></div>
                    <a href="/standards-export" class="mc-dropdown-item {% if request.path == '/standards-export' %}active{% endif %}">
                        <i class="fas fa-file-export"></i>
                        Export Documentation
                    </a>
                </div>
            </div>

            <div class="mc-nav-item mc-has-dropdown {% if request.path in ['/project-operations', '/projects', '/data-manager/drawings', '/data-manager/sheet-sets', '/project-standards-assignment', '/project-compliance'] or request.path.startswith('/projects/') %}active{% endif %}">
                <button class="mc-nav-link" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-folder"></i>
                    <span>Projects</span>
                    <i class="fas fa-chevron-down mc-dropdown-icon"></i>
                </button>
                <div class="mc-dropdown">
                    <a href="/project-operations" class="mc-dropdown-item {% if request.path == '/project-operations' %}active{% endif %}">
                        <i class="fas fa-th-large"></i>
                        Operations Home
                    </a>
                    <a href="/projects" class="mc-dropdown-item {% if request.path == '/projects' or request.path.startswith('/projects/') %}active{% endif %}">
                        <i class="fas fa-briefcase"></i>
                        Projects
                    </a>
                    <a href="/data-manager/drawings" class="mc-dropdown-item {% if request.path == '/data-manager/drawings' %}active{% endif %}">
                        <i class="fas fa-file-image"></i>
                        Drawings
                    </a>
                    <a href="/data-manager/sheet-sets" class="mc-dropdown-item {% if request.path == '/data-manager/sheet-sets' %}active{% endif %}">
                        <i class="fas fa-folder-open"></i>
                        Sheet Sets
                    </a>
                    <div class="mc-dropdown-divider"></div>
                    <a href="/project-standards-assignment" class="mc-dropdown-item {% if request.path == '/project-standards-assignment' %}active{% endif %}">
                        <i class="fas fa-link"></i>
                        Assign Standards
                    </a>
                    <a href="/project-compliance" class="mc-dropdown-item {% if request.path == '/project-compliance' %}active{% endif %}">
                        <i class="fas fa-check-circle"></i>
                        Compliance Dashboard
                    </a>
                </div>
            </div>

            <div class="mc-nav-item mc-has-dropdown {% if request.path in ['/dxf-tools', '/tools/batch-cad-import', '/tools/batch-block-import', '/map-viewer', '/map-viewer-v2', '/gravity-network-manager', '/pressure-network-manager', '/bmp-manager', '/sheet-notes', '/entity-viewer'] %}active{% endif %}">
                <button class="mc-nav-link" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-drafting-compass"></i>
                    <span>Tools</span>
                    <i class="fas fa-chevron-down mc-dropdown-icon"></i>
                </button>
                <div class="mc-dropdown">
                    <a href="/dxf-tools" class="mc-dropdown-item {% if request.path == '/dxf-tools' %}active{% endif %}">
                        <i class="fas fa-file-export"></i>
                        DXF Tools
                    </a>
                    <a href="/tools/batch-cad-import" class="mc-dropdown-item {% if request.path in ['/tools/batch-cad-import', '/tools/batch-block-import'] %}active{% endif %}">
                        <i class="fas fa-cubes"></i>
                        Batch CAD Import
                    </a>
                    <a href="/map-viewer-v2" class="mc-dropdown-item {% if request.path in ['/map-viewer', '/map-viewer-v2'] %}active{% endif %}">
                        <i class="fas fa-map-marked-alt"></i>
                        Map Viewer
                    </a>
                    <a href="/entity-viewer" class="mc-dropdown-item {% if request.path == '/entity-viewer' %}active{% endif %}">
                        <i class="fas fa-eye"></i>
                        Entity Viewer
                    </a>
                    <div class="mc-dropdown-divider"></div>
                    <div class="mc-dropdown-header">Network Managers</div>
                    <a href="/gravity-network-manager" class="mc-dropdown-item {% if request.path == '/gravity-network-manager' %}active{% endif %}">
                        <i class="fas fa-water"></i>
                        Gravity Network Manager
                    </a>
                    <a href="/pressure-network-manager" class="mc-dropdown-item {% if request.path == '/pressure-network-manager' %}active{% endif %}">
                        <i class="fas fa-tint"></i>
                        Pressure Network Manager
                    </a>
                    <a href="/bmp-manager" class="mc-dropdown-item {% if request.path == '/bmp-manager' %}active{% endif %}">
                        <i class="fas fa-leaf"></i>
                        BMP Manager
                    </a>
                    <div class="mc-dropdown-divider"></div>
                    <a href="/sheet-notes" class="mc-dropdown-item {% if request.path == '/sheet-notes' %}active{% endif %}">
                        <i class="fas fa-sticky-note"></i>
                        Sheet Notes
                    </a>
                </div>
            </div>

            <div class="mc-nav-item mc-has-dropdown {% if request.path in ['/usage-dashboard', '/quality-dashboard'] %}active{% endif %}">
                <button class="mc-nav-link" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-chart-line"></i>
                    <span>Analytics</span>
                    <i class="fas fa-chevron-down mc-dropdown-icon"></i>
                </button>
                <div class="mc-dropdown">
                    <a href="/usage-dashboard" class="mc-dropdown-item {% if request.path == '/usage-dashboard' %}active{% endif %}">
                        <i class="fas fa-chart-area"></i>
                        Usage Dashboard
                    </a>
                    <a href="/quality-dashboard" class="mc-dropdown-item {% if request.path == '/quality-dashboard' %}active{% endif %}">
                        <i class="fas fa-star"></i>
                        Quality Dashboard
                    </a>
                </div>
            </div>

            <div class="mc-nav-item mc-has-dropdown {% if request.path in ['/toolkit', '/graph'] %}active{% endif %}">
                <button class="mc-nav-link" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-robot"></i>
                    <span>AI</span>
                    <i class="fas fa-chevron-down mc-dropdown-icon"></i>
                </button>
                <div class="mc-dropdown">
                    <a href="/toolkit" class="mc-dropdown-item {% if request.path == '/toolkit' %}active{% endif %}">
                        <i class="fas fa-tools"></i>
                        AI Toolkit
                    </a>
                    <a href="/graph" class="mc-dropdown-item {% if request.path == '/graph' %}active{% endif %}">
                        <i class="fas fa-network-wired"></i>
                        Knowledge Graph
                    </a>
                </div>
            </div>

            <div class="mc-nav-item mc-has-dropdown {% if request.path.startswith('/schema') %}active{% endif %}">
                <button class="mc-nav-link" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-database"></i>
                    <span>Database</span>
                    <i class="fas fa-chevron-down mc-dropdown-icon"></i>
                </button>
                <div class="mc-dropdown">
                    <a href="/schema" class="mc-dropdown-item {% if request.path == '/schema' %}active{% endif %}">
                        <i class="fas fa-table"></i>
                        Schema
                    </a>
                    <a href="/schema/relationships" class="mc-dropdown-item {% if request.path == '/schema/relationships' %}active{% endif %}">
                        <i class="fas fa-project-diagram"></i>
                        Relationships
                    </a>
                </div>
            </div>

            <div class="mc-nav-item mc-has-dropdown {% if request.path in ['/why-this-matters', '/architecture'] %}active{% endif %}">
                <button class="mc-nav-link" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-info-circle"></i>
                    <span>About</span>
                    <i class="fas fa-chevron-down mc-dropdown-icon"></i>
                </button>
                <div class="mc-dropdown">
                    <a href="/why-this-matters" class="mc-dropdown-item {% if request.path == '/why-this-matters' %}active{% endif %}">
                        <i class="fas fa-lightbulb"></i>
                        Why This Matters
                    </a>
                    <a href="/architecture" class="mc-dropdown-item {% if request.path == '/architecture' %}active{% endif %}">
                        <i class="fas fa-sitemap"></i>
                        Architecture
                    </a>
                </div>
            </div>
        </div>
    </nav>
    </div>

    <main class="main-content" id="mainContent">
        <div class="container">
            {% block content %}{% endblock %}
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const navbar = document.getElementById('navbar');
            const mobileToggle = document.getElementById('mobileToggle');
            const navbarMenu = document.getElementById('navbarMenu');
            const dropdownItems = document.querySelectorAll('.mc-has-dropdown');
            
            mobileToggle.addEventListener('click', function() {
                const isExpanded = navbarMenu.classList.toggle('mc-navbar-menu-open');
                mobileToggle.setAttribute('aria-expanded', isExpanded);
            });
            
            dropdownItems.forEach(function(dropdown) {
                const button = dropdown.querySelector('.mc-nav-link');
                const menu = dropdown.querySelector('.mc-dropdown');
                
                if (!button || !menu) return;
                
                button.setAttribute('aria-controls', 'dropdown-' + Array.from(dropdownItems).indexOf(dropdown));
                menu.setAttribute('id', 'dropdown-' + Array.from(dropdownItems).indexOf(dropdown));
                
                button.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    
                    const isExpanded = dropdown.classList.toggle('mc-dropdown-open');
                    button.setAttribute('aria-expanded', isExpanded);
                    
                    dropdownItems.forEach(function(other) {
                        if (other !== dropdown && other.classList.contains('mc-dropdown-open')) {
                            other.classList.remove('mc-dropdown-open');
                            const otherButton = other.querySelector('.mc-nav-link');
                            if (otherButton) otherButton.setAttribute('aria-expanded', 'false');
                        }
                    });
                });
                
                dropdown.addEventListener('mouseenter', function() {
                    if (window.innerWidth > 768) {
                        dropdown.classList.add('mc-dropdown-open');
                        button.setAttribute('aria-expanded', 'true');
                    }
                });
                
                dropdown.addEventListener('mouseleave', function() {
                    if (window.innerWidth > 768) {
                        dropdown.classList.remove('mc-dropdown-open');
                        button.setAttribute('aria-expanded', 'false');
                    }
                });
                
                button.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && dropdown.classList.contains('mc-dropdown-open')) {
                        dropdown.classList.remove('mc-dropdown-open');
                        button.setAttribute('aria-expanded', 'false');
                        button.focus();
                    }
                });
            });
            
            document.addEventListener('click', function(e) {
                if (!navbar.contains(e.target)) {
                    dropdownItems.forEach(function(dropdown) {
                        if (dropdown.classList.contains('mc-dropdown-open')) {
                            dropdown.classList.remove('mc-dropdown-open');
                            const button = dropdown.querySelector('.mc-nav-link');
                            if (button) button.setAttribute('aria-expanded', 'false');
                        }
                    });
                }
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    dropdownItems.forEach(function(dropdown) {
                        if (dropdown.classList.contains('mc-dropdown-open')) {
                            dropdown.classList.remove('mc-dropdown-open');
                            const button = dropdown.querySelector('.mc-nav-link');
                            if (button) {
                                button.setAttribute('aria-expanded', 'false');
                                button.focus();
                            }
                        }
                    });
                }
            });
        });

        async function checkHealth() {
            try {
                const response = await fetch('/api/health');
                const data = await response.json();
                return data.status === 'connected';
            } catch {
                return false;
            }
        }

        async function deleteItem(endpoint, id, itemName) {
            if (!confirm(`Are you sure you want to delete ${itemName}?`)) {
                return;
            }

            try {
                const response = await fetch(`${endpoint}/${id}`, {
                    method: 'DELETE'
                });

                if (response.ok) {
                    location.reload();
                } else {
                    const error = await response.json();
                    alert(`Error: ${error.error || 'Failed to delete'}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>

    {% block scripts %}{% endblock %}
</body>
</html>
