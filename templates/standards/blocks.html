{% extends 'base.html' %}

{% block title %}Block Standards{% endblock %}

{% block content %}
<div class="container">
    <div class="panel">
        <div class="panel-header">
            <div>
                <i class="fas fa-cubes neon-cyan"></i>
                <h2>Blocks & Symbols</h2>
            </div>
            <div id="block-count" style="font-size: 0.9rem; color: var(--text-secondary);"></div>
        </div>
        <div class="panel-body">
            <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">
                Standard CAD blocks and symbols organized by category with visual previews and usage context.
            </p>

            <div id="blocks-container">
                <div class="loading-spinner">
                    <i class="fas fa-spinner fa-spin neon-cyan"></i>
                    <p>Loading block standards...</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    async function loadBlocks() {
        try {
            const response = await fetch('/api/standards/blocks');
            const blocks = await response.json();
            
            if (blocks.error) {
                throw new Error(blocks.error);
            }

            document.getElementById('block-count').textContent = `${blocks.length} blocks`;

            const grouped = {};
            blocks.forEach(block => {
                const category = block.category || 'Other';
                if (!grouped[category]) {
                    grouped[category] = [];
                }
                grouped[category].push(block);
            });

            const container = document.getElementById('blocks-container');
            container.innerHTML = '';

            Object.keys(grouped).sort().forEach(category => {
                const section = document.createElement('div');
                section.style.marginBottom = '2.5rem';
                
                const title = document.createElement('h3');
                title.className = 'orbitron';
                title.style.color = 'var(--cyan)';
                title.style.marginBottom = '1rem';
                title.innerHTML = `<i class="fas fa-folder"></i> ${category}`;
                section.appendChild(title);

                const grid = document.createElement('div');
                grid.style.display = 'grid';
                grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(300px, 1fr))';
                grid.style.gap = '1rem';

                grouped[category].forEach(block => {
                    const card = document.createElement('div');
                    card.style.background = 'rgba(0, 28, 48, 0.6)';
                    card.style.border = '1px solid var(--border)';
                    card.style.borderRadius = '8px';
                    card.style.padding = '1rem';
                    card.style.transition = 'all 0.3s ease';

                    let svgPreview = '';
                    if (block.svg_content) {
                        svgPreview = `
                            <div style="background: white; border-radius: 4px; padding: 1rem; margin-bottom: 1rem; display: flex; align-items: center; justify-content: center; min-height: 120px;">
                                ${block.svg_content}
                            </div>
                        `;
                    }

                    const tags = block.tags ? (Array.isArray(block.tags) ? block.tags : [block.tags]) : [];
                    const tagHtml = tags.length > 0 ? `
                        <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.75rem;">
                            ${tags.map(tag => `<span style="background: rgba(0, 255, 255, 0.1); color: var(--cyan); padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.75rem;">${tag}</span>`).join('')}
                        </div>
                    ` : '';

                    card.innerHTML = `
                        ${svgPreview}
                        <div style="font-weight: bold; color: var(--cyan); font-size: 1.1rem; margin-bottom: 0.5rem;">${block.block_name}</div>
                        ${block.block_type ? `<div style="color: var(--text-secondary); font-size: 0.85rem; margin-bottom: 0.5rem;">Type: ${block.block_type}</div>` : ''}
                        ${block.description ? `<div style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 0.5rem;">${block.description}</div>` : ''}
                        ${block.usage_context ? `<div style="font-size: 0.85rem; color: var(--text-muted); margin-top: 0.5rem;"><strong>Usage:</strong> ${block.usage_context}</div>` : ''}
                        ${block.semantic_label ? `<div style="font-size: 0.85rem; color: var(--text-muted);"><strong>Label:</strong> ${block.semantic_label}</div>` : ''}
                        ${tagHtml}
                    `;

                    grid.appendChild(card);
                });

                section.appendChild(grid);
                container.appendChild(section);
            });

        } catch (error) {
            document.getElementById('blocks-container').innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p>Failed to load block standards: ${error.message}</p>
                </div>
            `;
        }
    }

    loadBlocks();
</script>
{% endblock %}
