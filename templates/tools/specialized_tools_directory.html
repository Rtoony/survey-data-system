{% extends "base.html" %}

{% block title %}Specialized Tools Directory - ACAD-GIS{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-tools"></i> Specialized Tools Directory</h1>
    <p>Interactive management tools for specific CAD layer types</p>
</div>

<div class="mc-card">
    <div class="mc-card-content">
        <div class="directory-controls">
            <div class="directory-search">
                <input type="text"
                       id="searchInput"
                       placeholder="Search tools by name, object type, or description..."
                       oninput="searchTools(this.value)">
            </div>
            <div class="directory-count">
                <i class="fas fa-layer-group"></i>
                <span id="toolCount">Loading...</span>
            </div>
        </div>

        <div id="toolsDirectory" class="tools-directory">
            <div class="directory-loading-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p style="font-size: 18px;">Loading specialized tools...</p>
            </div>
        </div>
    </div>
</div>

<style>
.page-header {
    margin-bottom: 2rem;
}

.directory-controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    align-items: center;
}

.directory-search {
    flex: 1;
    max-width: 400px;
}

.directory-search input {
    width: 100%;
    padding: 0.75rem 1rem;
    background: rgba(0, 40, 80, 0.6);
    border: 1px solid rgba(0, 255, 255, 0.3);
    border-radius: 6px;
    color: var(--text-primary);
    font-size: 14px;
}

.directory-search input:focus {
    outline: none;
    border-color: var(--accent-cyan);
    box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
}

.directory-count {
    color: var(--text-dim);
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.tools-directory {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: 1.5rem;
}

.directory-tool-card {
    background: linear-gradient(135deg, rgba(0, 255, 100, 0.03), rgba(0, 200, 255, 0.03));
    border: 2px solid rgba(0, 255, 100, 0.2);
    border-radius: 12px;
    padding: 1.5rem;
    transition: all 0.3s;
    display: flex;
    flex-direction: column;
    height: 280px;
    position: relative;
    overflow: hidden;
}

.directory-tool-card:hover {
    border-color: rgba(0, 255, 100, 0.5);
    box-shadow: 0 8px 24px rgba(0, 255, 100, 0.2);
    transform: translateY(-4px);
}

.directory-tool-icon {
    font-size: 48px;
    margin-bottom: 1rem;
    display: block;
}

.directory-tool-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--accent-green);
    margin: 0 0 0.5rem 0;
    line-height: 1.2;
}

.directory-tool-subtitle {
    font-size: 11px;
    color: var(--text-dim);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.75rem;
    font-family: 'Courier New', monospace;
}

.directory-tool-description {
    font-size: 13px;
    color: var(--text-secondary);
    line-height: 1.5;
    margin-bottom: 1rem;
    flex: 1;
    overflow: hidden;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
}

.directory-tool-footer {
    margin-top: auto;
    display: flex;
    gap: 0.5rem;
}

.directory-tool-link {
    flex: 1;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    background: linear-gradient(135deg, rgba(0, 255, 100, 0.2), rgba(0, 200, 255, 0.2));
    border: 1px solid rgba(0, 255, 100, 0.4);
    color: var(--accent-green);
    padding: 0.65rem 1rem;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.2s;
}

.directory-tool-link:hover {
    background: linear-gradient(135deg, rgba(0, 255, 100, 0.3), rgba(0, 200, 255, 0.3));
    border-color: rgba(0, 255, 100, 0.6);
    transform: translateX(2px);
}

.directory-empty-state,
.directory-loading-state,
.directory-error-state {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-dim);
}

.directory-empty-state i,
.directory-loading-state i,
.directory-error-state i {
    font-size: 48px;
    margin-bottom: 1.5rem;
    display: block;
}

.directory-loading-state i {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.no-results-message {
    grid-column: 1 / -1;
    text-align: center;
    padding: 3rem;
    color: var(--text-dim);
}
</style>

<script>
let allTools = [];

async function loadToolsDirectory() {
    try {
        const response = await fetch('/api/cad-standards/specialized-tools-directory');
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();
        allTools = data.tools || [];

        updateToolCount();
        renderTools(allTools);

    } catch (error) {
        console.error('Error loading tools directory:', error);
        document.getElementById('toolsDirectory').innerHTML = `
            <div class="directory-error-state">
                <i class="fas fa-exclamation-triangle" style="color: var(--accent-red);"></i>
                <p style="font-size: 18px;">Failed to load specialized tools.</p>
                <p style="font-size: 14px;">Please try refreshing the page.</p>
            </div>
        `;
    }
}

function renderTools(tools) {
    const container = document.getElementById('toolsDirectory');

    if (!tools || tools.length === 0) {
        container.innerHTML = `
            <div class="directory-empty-state">
                <i class="fas fa-info-circle"></i>
                <p style="font-size: 18px;">No specialized tools available yet.</p>
                <p style="font-size: 14px;">New tools will automatically appear here as they are added to the system.</p>
            </div>
        `;
        return;
    }

    container.innerHTML = tools.map(tool => `
        <div class="directory-tool-card">
            <div class="directory-tool-icon">${tool.tool_icon || 'ðŸ”§'}</div>
            <h2 class="directory-tool-title">${tool.tool_name}</h2>
            <div class="directory-tool-subtitle">${tool.object_code} - ${tool.object_name}</div>
            <p class="directory-tool-description">${tool.description || 'Interactive management tool for specialized CAD layers'}</p>
            <div class="directory-tool-footer">
                <a href="${tool.tool_url}" class="directory-tool-link">
                    <i class="fas fa-external-link-alt"></i> Launch Tool
                </a>
            </div>
        </div>
    `).join('');
}

function searchTools(query) {
    const searchTerm = query.toLowerCase().trim();

    if (!searchTerm) {
        renderTools(allTools);
        return;
    }

    const filtered = allTools.filter(tool =>
        tool.tool_name.toLowerCase().includes(searchTerm) ||
        tool.object_code.toLowerCase().includes(searchTerm) ||
        tool.object_name.toLowerCase().includes(searchTerm) ||
        (tool.description && tool.description.toLowerCase().includes(searchTerm))
    );

    renderTools(filtered);

    if (filtered.length === 0) {
        document.getElementById('toolsDirectory').innerHTML = `
            <div class="no-results-message">
                <i class="fas fa-search" style="font-size: 32px; margin-bottom: 1rem; display: block; opacity: 0.3;"></i>
                <p>No tools found matching "${query}"</p>
            </div>
        `;
    }
}

function updateToolCount() {
    const countElement = document.getElementById('toolCount');
    if (countElement) {
        countElement.textContent = `${allTools.length} ${allTools.length === 1 ? 'Tool' : 'Tools'} Available`;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    loadToolsDirectory();
});
</script>
{% endblock %}
