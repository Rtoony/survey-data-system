{% extends "base_specialized_tool.html" %}

{% block tool_title %}Area Calculator{% endblock %}
{% block tool_icon %}fas fa-ruler-combined{% endblock %}
{% block tool_description %}Calculate accurate areas for closed polygons and 3D regions{% endblock %}

{% block content_layout_class %}tool-complex-layout{% endblock %}

{% block sidebar_content %}
<div class="tool-info-box">
    <div class="tool-name">
        <i class="fas fa-ruler-combined"></i>
        <span>Area Calculator</span>
    </div>
    <div class="tool-description">
        Calculate areas for closed polygons grouped by object classification
    </div>
</div>

<div class="tool-filter-section">
    <h4>Object Categories</h4>
    <div class="tool-checkbox-item">
        <input type="checkbox" id="filterAccessible" checked onchange="applyFilters()">
        <label for="filterAccessible">Accessible Features</label>
    </div>
    <div class="tool-checkbox-item">
        <input type="checkbox" id="filterBMP" checked onchange="applyFilters()">
        <label for="filterBMP">BMPs & Stormwater</label>
    </div>
    <div class="tool-checkbox-item">
        <input type="checkbox" id="filterGrading" checked onchange="applyFilters()">
        <label for="filterGrading">Grading & Earthwork</label>
    </div>
    <div class="tool-checkbox-item">
        <input type="checkbox" id="filterPaving" checked onchange="applyFilters()">
        <label for="filterPaving">Paving & Hardscape</label>
    </div>
    <div class="tool-checkbox-item">
        <input type="checkbox" id="filterLandscape" checked onchange="applyFilters()">
        <label for="filterLandscape">Landscape Areas</label>
    </div>
    <div class="tool-checkbox-item">
        <input type="checkbox" id="filterBuildings" checked onchange="applyFilters()">
        <label for="filterBuildings">Buildings & Structures</label>
    </div>
</div>

<div class="tool-filter-section">
    <h4>Area Units</h4>
    <div class="tool-filter-item">
        <label>Display Units:</label>
        <select id="unitSelect" onchange="updateUnits()">
            <option value="sf">Square Feet (SF)</option>
            <option value="acres">Acres</option>
            <option value="hectares">Hectares</option>
            <option value="sm">Square Meters (m²)</option>
        </select>
    </div>
</div>

<div class="tool-stats-section">
    <h4>Quick Stats</h4>
    <div class="tool-stat-item">
        <span class="tool-stat-label">Total Polygons:</span>
        <span class="tool-stat-value" id="sidebarTotalPolygons">0</span>
    </div>
    <div class="tool-stat-item">
        <span class="tool-stat-label">Total Area:</span>
        <span class="tool-stat-value" id="sidebarTotalArea">0 SF</span>
    </div>
    <div class="tool-stat-item">
        <span class="tool-stat-label">Largest Feature:</span>
        <span class="tool-stat-value" id="sidebarLargestFeature">— </span>
    </div>
</div>

<button class="tool-action-btn" onclick="calculateAreas()">
    <i class="fas fa-calculator"></i> Calculate Areas
</button>
<button class="tool-action-btn secondary" onclick="exportReport()">
    <i class="fas fa-file-export"></i> Export Takeoff
</button>
{% endblock %}

{% block main_content %}
<div class="tool-top-area">
    <div id="areaVisualContainer" style="height: 100%; width: 100%; background: #0a1929; position: relative; display: flex; align-items: center; justify-content: center; flex-direction: column;">
        <i class="fas fa-ruler-combined" style="font-size: 64px; color: var(--mc-primary); opacity: 0.3; margin-bottom: 1rem;"></i>
        <p style="color: var(--mc-text); font-size: 18px; opacity: 0.6;">Area Calculation Visualization</p>
        <p style="color: var(--mc-muted); font-size: 14px; opacity: 0.4; margin-top: 0.5rem;">Load project data to begin area calculations</p>
    </div>
</div>

<div class="tool-resizer"></div>

<div class="tool-bottom-area">
    <div class="tool-data-tabs">
        <button class="tool-data-tab active" onclick="showTab('areas')">
            <i class="fas fa-th-list"></i> Areas (<span id="areasTabCount">0</span>)
        </button>
        <button class="tool-data-tab" onclick="showTab('bycategory')">
            <i class="fas fa-layer-group"></i> By Category
        </button>
        <button class="tool-data-tab" onclick="showTab('summary')">
            <i class="fas fa-chart-bar"></i> Summary
        </button>
    </div>

    <div class="tool-data-content">
        <!-- Areas Tab -->
        <div id="areasTab" class="tab-content">
            <table class="tool-data-table" id="areasTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Feature Name</th>
                        <th>Category</th>
                        <th>Object Type</th>
                        <th>Area (SF)</th>
                        <th>Area (Acres)</th>
                        <th>Geometry Type</th>
                        <th>Layer</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="areasTableBody"></tbody>
            </table>
            <div id="areasEmpty" style="text-align: center; padding: 3rem; color: var(--mc-text);">
                <i class="fas fa-inbox" style="font-size: 48px; opacity: 0.3; margin-bottom: 1rem;"></i>
                <p>No area calculations available</p>
                <p style="color: var(--mc-muted); font-size: 0.9rem; margin-top: 0.5rem;">
                    Load project data and click "Calculate Areas" to begin
                </p>
            </div>
        </div>

        <!-- By Category Tab -->
        <div id="bycategoryTab" class="tab-content" style="display: none;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-wheelchair"></i> Accessible Features
                    </div>
                    <div class="stat-value" id="statAccessible">0 SF</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-water"></i> BMPs & Stormwater
                    </div>
                    <div class="stat-value" id="statBMP">0 SF</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-mountain"></i> Grading & Earthwork
                    </div>
                    <div class="stat-value" id="statGrading">0 SF</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-road"></i> Paving & Hardscape
                    </div>
                    <div class="stat-value" id="statPaving">0 SF</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-tree"></i> Landscape Areas
                    </div>
                    <div class="stat-value" id="statLandscape">0 SF</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-building"></i> Buildings & Structures
                    </div>
                    <div class="stat-value" id="statBuildings">0 SF</div>
                </div>
            </div>

            <h4 style="color: var(--mc-accent); margin: 2rem 0 1rem 0;">
                <i class="fas fa-chart-pie"></i> Area Distribution
            </h4>
            <div id="categoryBreakdown" style="background: rgba(0,40,80,0.4); border-radius: 8px; padding: 1.5rem;">
                <p style="color: var(--mc-muted); text-align: center;">Category breakdown chart will appear here</p>
            </div>
        </div>

        <!-- Summary Tab -->
        <div id="summaryTab" class="tab-content" style="display: none;">
            <div style="background: rgba(0,255,255,0.1); border: 2px solid rgba(0,255,255,0.3); border-radius: 12px; padding: 2rem; margin-bottom: 2rem;">
                <h3 style="color: var(--mc-primary); margin: 0 0 1.5rem 0;">
                    <i class="fas fa-calculator"></i> Total Area Summary
                </h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 2rem;">
                    <div>
                        <div style="color: var(--mc-muted); font-size: 0.9rem; margin-bottom: 0.5rem;">Total (SF)</div>
                        <div style="color: var(--mc-accent); font-size: 2rem; font-weight: bold;" id="summaryTotalSF">0 SF</div>
                    </div>
                    <div>
                        <div style="color: var(--mc-muted); font-size: 0.9rem; margin-bottom: 0.5rem;">Total (Acres)</div>
                        <div style="color: var(--mc-accent); font-size: 2rem; font-weight: bold;" id="summaryTotalAcres">0 ac</div>
                    </div>
                    <div>
                        <div style="color: var(--mc-muted); font-size: 0.9rem; margin-bottom: 0.5rem;">Feature Count</div>
                        <div style="color: var(--mc-accent); font-size: 2rem; font-weight: bold;" id="summaryFeatureCount">0</div>
                    </div>
                    <div>
                        <div style="color: var(--mc-muted); font-size: 0.9rem; margin-bottom: 0.5rem;">Categories</div>
                        <div style="color: var(--mc-accent); font-size: 2rem; font-weight: bold;" id="summaryCategoryCount">0</div>
                    </div>
                </div>
            </div>

            <div style="background: rgba(0,40,80,0.4); border-radius: 8px; padding: 1.5rem; margin-bottom: 2rem;">
                <h4 style="color: var(--mc-primary); margin: 0 0 1rem 0;">
                    <i class="fas fa-info-circle"></i> Area Calculation Methods
                </h4>
                <div style="color: var(--mc-text); line-height: 1.8;">
                    <p><strong>2D Polygons:</strong> Uses planar area calculation for closed polylines and 2D regions</p>
                    <p style="margin-top: 0.5rem;"><strong>3D Regions:</strong> Projects 3D surfaces to horizontal plane for area calculation</p>
                    <p style="margin-top: 0.5rem;"><strong>Unit Conversions:</strong></p>
                    <ul style="color: var(--mc-muted); font-size: 0.9rem; margin-top: 0.5rem; padding-left: 2rem;">
                        <li>1 acre = 43,560 square feet</li>
                        <li>1 hectare = 107,639 square feet = 2.471 acres</li>
                        <li>1 square meter = 10.764 square feet</li>
                    </ul>
                </div>
            </div>

            <div style="background: linear-gradient(135deg, rgba(0,255,255,0.05), rgba(0,255,136,0.05)); border-radius: 8px; padding: 1.5rem;">
                <h4 style="color: var(--mc-accent); margin: 0 0 1rem 0;">
                    <i class="fas fa-link"></i> Integration with Other Tools
                </h4>
                <p style="color: var(--mc-text); margin: 0; line-height: 1.6;">
                    Area calculations from this tool feed directly into the <strong>Material Volume Calculator</strong> and
                    <strong>Pervious/Impervious Analysis</strong> tools for comprehensive quantity takeoffs and site hydrology assessment.
                </p>
            </div>
        </div>
    </div>
</div>

<style>
.tab-content { padding: 1rem; }
.stat-card {
    background: rgba(0,255,255,0.05);
    border: 1px solid rgba(0,255,255,0.2);
    padding: 1.5rem;
    border-radius: 8px;
    text-align: center;
}
.stat-label {
    color: var(--mc-muted);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}
.stat-value {
    color: var(--mc-primary);
    font-size: 1.8rem;
    font-weight: bold;
}
</style>
{% endblock %}

{% block about_tool_description %}
<p>
    The <strong>Area Calculator</strong> is a specialized tool for calculating accurate areas of closed polygons and
    3D regions based on their object classification. This tool processes all polygon features in your project and
    groups them by category for comprehensive area takeoffs.
</p>
<p style="margin-top: 1rem;">
    Supports 2D closed polylines, 3D closed polylines (projected to horizontal plane), and polygon regions. Area
    calculations integrate with the Material Volume Calculator for earthwork quantification and the Pervious/Impervious
    Analysis tool for site hydrology assessment.
</p>
{% endblock %}

{% block about_tool_tags %}
<span class="about-tool-tag">AREA</span>
<span class="about-tool-tag">POLYGON</span>
<span class="about-tool-tag">ACCESSIBLE</span>
<span class="about-tool-tag">BMP</span>
<span class="about-tool-tag">GRADING</span>
<span class="about-tool-tag">PAVING</span>
<span class="about-tool-tag">LANDSCAPE</span>
<span class="about-tool-tag">BUILDING</span>
{% endblock %}

{% block about_tool_examples %}
<div class="about-tool-example">
    <div class="about-tool-example-layer">CIV-ACBL-PATH-CONCRETE-NEW-PL</div>
    <div class="about-tool-example-desc">→ Accessible path area calculation</div>
</div>
<div class="about-tool-example">
    <div class="about-tool-example-layer">CIV-BMP-BIORET-BASIN-NEW-PL</div>
    <div class="about-tool-example-desc">→ Bioretention basin surface area</div>
</div>
<div class="about-tool-example">
    <div class="about-tool-example-layer">CIV-GRAD-PAD-BLDG-NEW-3D</div>
    <div class="about-tool-example-desc">→ Building pad grading area</div>
</div>
<div class="about-tool-example">
    <div class="about-tool-example-layer">CIV-PVMT-ASPH-PARKING-NEW-PL</div>
    <div class="about-tool-example-desc">→ Parking lot paving area</div>
</div>
<div class="about-tool-example">
    <div class="about-tool-example-layer">CIV-LAND-TURF-HYDROSEED-NEW-PL</div>
    <div class="about-tool-example-desc">→ Landscape hydroseeding area</div>
</div>
<div class="about-tool-example">
    <div class="about-tool-example-layer">ARCH-BLDG-FOOTPRINT-MAIN-NEW-PL</div>
    <div class="about-tool-example-desc">→ Building footprint area</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Initialize the tool
let areaData = [];
let currentUnit = 'sf';

function applyFilters() {
    console.log('Filters applied');
    renderAreaData();
}

function updateUnits() {
    currentUnit = document.getElementById('unitSelect').value;
    renderAreaData();
}

function calculateAreas() {
    console.log('Calculating areas...');

    const emptyDiv = document.getElementById('areasEmpty');
    emptyDiv.innerHTML = `
        <i class="fas fa-spinner fa-spin" style="font-size: 48px; color: var(--mc-primary); margin-bottom: 1rem;"></i>
        <p>Calculating polygon areas...</p>
    `;

    // Simulate API call
    setTimeout(() => {
        emptyDiv.innerHTML = `
            <i class="fas fa-inbox" style="font-size: 48px; opacity: 0.3; margin-bottom: 1rem;"></i>
            <p>No area calculations available</p>
            <p style="color: var(--mc-muted); font-size: 0.9rem; margin-top: 0.5rem;">
                Connect to an active project to calculate areas
            </p>
        `;
    }, 1500);
}

function renderAreaData() {
    const tbody = document.getElementById('areasTableBody');
    const table = document.getElementById('areasTable');
    const emptyDiv = document.getElementById('areasEmpty');

    if (areaData.length === 0) {
        table.style.display = 'none';
        emptyDiv.style.display = 'block';
        return;
    }

    table.style.display = 'table';
    emptyDiv.style.display = 'none';

    // Update counts
    document.getElementById('areasTabCount').textContent = areaData.length;
    document.getElementById('sidebarTotalPolygons').textContent = areaData.length;
}

function showTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
    });

    document.querySelectorAll('.tool-data-tab').forEach(btn => {
        btn.classList.remove('active');
    });

    const selectedTab = document.getElementById(tabName + 'Tab');
    if (selectedTab) {
        selectedTab.style.display = 'block';
    }

    event.target.closest('.tool-data-tab').classList.add('active');
}

function exportReport() {
    console.log('Exporting area takeoff report...');
    alert('Area takeoff export functionality will be implemented here');
}

// Initialize on page load
document.addEventListener('DOMContentLoaded', function() {
    console.log('Area Calculator loaded');
    renderAreaData();
});
</script>
{% endblock %}
